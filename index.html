<!DOCTYPE html>

<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>CBASæ‹†è§£æ•´åˆç³»çµ± v1.0 | Rexå¤§å”æŠ•è³‡ç ”ç©¶å®¤</title>
    <script src="https://unpkg.com/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
    <style>
        :root { 
            --primary: #2563eb; --primary-dark: #1d4ed8; --bg: #f8fafc; --text: #1e293b; --gray: #64748b; 
            --border: #e2e8f0; --up: #dc2626; --down: #16a34a; 
            --clickable: #eff6ff; --clickable-hover: #dbeafe; --clickable-border: #93c5fd;
            --warning: #f59e0b; --info: #0ea5e9; --listed: #16a34a; --delisted: #94a3b8;
            --cbas-primary: #7c3aed; --cbas-bg: #f5f3ff; --cbas-border: #c4b5fd;
            --card-shadow: 0 1px 3px rgba(0,0,0,0.1), 0 1px 2px rgba(0,0,0,0.06);
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, "Microsoft JhengHei", "Segoe UI", sans-serif; background: var(--bg); color: var(--text); font-size: 15px; line-height: 1.6; }
        .container { max-width: 1400px; margin: 0 auto; padding: 16px; }
        @media(min-width: 1600px) { .container { max-width: 1800px; } }

```
    /* è¼‰å…¥ç•«é¢ */
    .loading { position: fixed; top:0; left:0; right:0; bottom:0; background: var(--bg); z-index: 9999; display: flex; flex-direction: column; align-items: center; justify-content: center; transition: opacity 0.3s; }
    .loading.hidden { opacity: 0; pointer-events: none; }
    .loading.removed { display: none; }
    .spinner { width: 48px; height: 48px; border: 4px solid #e0e0e0; border-top-color: var(--primary); border-radius: 50%; animation: spin 1s linear infinite; margin-bottom: 20px; }
    @keyframes spin { to { transform: rotate(360deg); } }
    .load-progress { width: 280px; height: 6px; background: #e0e0e0; border-radius: 3px; overflow: hidden; margin-top: 16px; }
    .load-progress-bar { height: 100%; background: linear-gradient(90deg, var(--primary), var(--cbas-primary)); width: 0%; transition: width 0.3s; }

    /* æ›´æ–°æç¤º */
    .update-toast { position: fixed; bottom: 20px; right: 20px; background: rgba(0,0,0,0.85); color: #fff; padding: 12px 20px; border-radius: 10px; font-size: 14px; z-index: 1000; opacity: 0; transform: translateY(20px); transition: all 0.3s; }
    .update-toast.show { opacity: 1; transform: translateY(0); }

    /* é é¦– */
    .header { background: linear-gradient(135deg, var(--primary) 0%, var(--cbas-primary) 100%); color: #fff; padding: 24px; border-radius: 16px; margin-bottom: 20px; box-shadow: var(--card-shadow); }
    .header h1 { font-size: 26px; font-weight: 800; margin-bottom: 6px; display: flex; align-items: center; gap: 12px; }
    .header h1 .icon { font-size: 32px; }
    .header .subtitle { opacity: 0.9; font-size: 14px; }
    .header .version { display: inline-block; background: rgba(255,255,255,0.2); font-size: 12px; padding: 3px 10px; border-radius: 12px; margin-left: 10px; }

    /* ä¸»é¸å–® */
    .main-nav { display: flex; gap: 8px; margin-bottom: 20px; flex-wrap: wrap; background: #fff; padding: 12px; border-radius: 12px; box-shadow: var(--card-shadow); }
    .nav-item { padding: 12px 20px; border-radius: 10px; font-size: 15px; font-weight: 600; cursor: pointer; border: 2px solid transparent; background: var(--bg); color: var(--gray); transition: all 0.2s; display: flex; align-items: center; gap: 8px; }
    .nav-item:hover { background: var(--clickable); border-color: var(--clickable-border); color: var(--primary); }
    .nav-item.active { background: var(--primary); color: #fff; border-color: var(--primary); }
    .nav-item.cbas { background: var(--cbas-bg); border-color: var(--cbas-border); }
    .nav-item.cbas:hover { background: #ede9fe; }
    .nav-item.cbas.active { background: var(--cbas-primary); color: #fff; border-color: var(--cbas-primary); }
    .nav-item .badge { background: rgba(0,0,0,0.1); padding: 2px 8px; border-radius: 10px; font-size: 12px; }
    .nav-item.active .badge { background: rgba(255,255,255,0.3); }

    /* çµ±è¨ˆå¡ç‰‡å€ */
    .stats-cards { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 16px; margin-bottom: 20px; }
    .stat-card { background: #fff; padding: 20px; border-radius: 12px; box-shadow: var(--card-shadow); text-align: center; transition: transform 0.2s, box-shadow 0.2s; }
    .stat-card:hover { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
    .stat-card.clickable { cursor: pointer; }
    .stat-card.active { border: 2px solid var(--primary); background: var(--clickable); }
    .stat-card .icon { font-size: 28px; margin-bottom: 8px; }
    .stat-card .value { font-size: 28px; font-weight: 800; color: var(--primary); font-family: 'Menlo', 'Monaco', monospace; }
    .stat-card .label { font-size: 13px; color: var(--gray); margin-top: 4px; }
    .stat-card.cbas .value { color: var(--cbas-primary); }

    /* å…§å®¹å€å¡Š */
    .content-section { background: #fff; border-radius: 12px; padding: 20px; margin-bottom: 20px; box-shadow: var(--card-shadow); }
    .section-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px; flex-wrap: wrap; gap: 12px; }
    .section-title { font-size: 18px; font-weight: 700; color: var(--text); display: flex; align-items: center; gap: 10px; }
    .section-title .icon { font-size: 22px; }

    /* æœå°‹å€ */
    .search-box { display: flex; gap: 12px; flex-wrap: wrap; align-items: center; }
    .search-input { flex: 1; min-width: 200px; max-width: 350px; padding: 12px 16px; border-radius: 10px; border: 2px solid var(--border); font-size: 15px; outline: none; transition: border-color 0.2s; }
    .search-input:focus { border-color: var(--primary); }
    .search-btn { padding: 12px 24px; border-radius: 10px; border: none; background: var(--primary); color: #fff; font-size: 15px; font-weight: 600; cursor: pointer; transition: background 0.2s; display: flex; align-items: center; gap: 6px; }
    .search-btn:hover { background: var(--primary-dark); }

    /* ç¯©é¸æ¨™ç±¤ */
    .filter-tabs { display: flex; gap: 8px; flex-wrap: wrap; }
    .filter-tab { padding: 8px 16px; border-radius: 20px; font-size: 13px; font-weight: 600; cursor: pointer; border: 1px solid var(--border); background: #fff; color: var(--gray); transition: all 0.2s; }
    .filter-tab:hover { border-color: var(--primary); background: var(--clickable); color: var(--primary); }
    .filter-tab.active { background: var(--primary); color: #fff; border-color: var(--primary); }
    .filter-tab.cbas.active { background: var(--cbas-primary); border-color: var(--cbas-primary); }

    /* æ™‚é–“ç¯©é¸ */
    .period-tabs { display: flex; gap: 6px; flex-wrap: wrap; }
    .period-tab { padding: 6px 14px; border-radius: 8px; font-size: 13px; font-weight: 600; cursor: pointer; border: 1px solid var(--border); background: #fff; color: var(--gray); transition: all 0.2s; }
    .period-tab:hover { border-color: var(--primary); }
    .period-tab.active { background: var(--info); color: #fff; border-color: var(--info); }

    /* è¡¨æ ¼æ¨£å¼ */
    .table-container { overflow-x: auto; border-radius: 10px; border: 1px solid var(--border); }
    table { width: 100%; border-collapse: collapse; font-size: 14px; }
    th, td { padding: 12px 10px; text-align: left; border-bottom: 1px solid var(--border); white-space: nowrap; }
    th { background: linear-gradient(180deg, #f8fafc 0%, #f1f5f9 100%); font-weight: 700; position: sticky; top: 0; cursor: pointer; user-select: none; text-align: center; color: var(--text); }
    th:hover { background: #e2e8f0; }
    th.sorted-asc::after { content: ' â–²'; color: var(--primary); font-size: 10px; }
    th.sorted-desc::after { content: ' â–¼'; color: var(--primary); font-size: 10px; }
    tbody tr { transition: background 0.15s; }
    tbody tr:hover { background: var(--clickable); cursor: pointer; }
    tbody tr:nth-child(even) { background: #fafbfc; }
    tbody tr:nth-child(even):hover { background: var(--clickable); }
    .code { color: var(--primary); font-weight: 700; font-family: 'Menlo', monospace; }
    .up { color: var(--up); font-weight: 600; }
    .down { color: var(--down); font-weight: 600; }
    .text-right { text-align: right; }
    .text-center { text-align: center; }
    .mono { font-family: 'Menlo', 'Monaco', monospace; }

    /* CBAS ç‰¹æ®Šæ¨™è¨˜ */
    .cbas-badge { display: inline-flex; align-items: center; gap: 4px; padding: 3px 10px; border-radius: 12px; font-size: 12px; font-weight: 600; }
    .cbas-badge.has-cbas { background: var(--cbas-bg); color: var(--cbas-primary); border: 1px solid var(--cbas-border); }
    .cbas-badge.no-cbas { background: #f1f5f9; color: var(--gray); }
    
    /* æ¬Šåˆ©é‡‘é¡è‰²æ¨™è¨˜ */
    .premium-high { background: rgba(220, 38, 38, 0.08); }
    .premium-mid { background: rgba(245, 158, 11, 0.08); }
    .premium-low { background: rgba(22, 163, 74, 0.08); }

    /* å½ˆçª— */
    .modal { display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); z-index: 1000; align-items: center; justify-content: center; padding: 20px; }
    .modal.show { display: flex; }
    .modal-content { background: #fff; border-radius: 16px; max-width: 1000px; width: 100%; max-height: 90vh; overflow: hidden; display: flex; flex-direction: column; box-shadow: 0 20px 40px rgba(0,0,0,0.2); }
    .modal-header { padding: 20px 24px; border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center; background: linear-gradient(135deg, var(--primary) 0%, var(--cbas-primary) 100%); color: #fff; }
    .modal-header h3 { font-size: 20px; font-weight: 700; display: flex; align-items: center; gap: 10px; }
    .modal-close { width: 36px; height: 36px; border-radius: 50%; border: none; background: rgba(255,255,255,0.2); color: #fff; font-size: 20px; cursor: pointer; transition: background 0.2s; }
    .modal-close:hover { background: rgba(255,255,255,0.3); }
    .modal-body { padding: 24px; overflow-y: auto; flex: 1; }

    /* è©³ç´°è³‡æ–™å€å¡Š */
    .detail-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 16px; margin-bottom: 20px; }
    .detail-card { background: var(--bg); padding: 16px; border-radius: 10px; }
    .detail-card .label { font-size: 12px; color: var(--gray); margin-bottom: 4px; }
    .detail-card .value { font-size: 18px; font-weight: 700; color: var(--text); }
    .detail-card .value.highlight { color: var(--primary); }
    .detail-card .value.cbas { color: var(--cbas-primary); }

    /* CBASæ­·å²åœ–è¡¨å€ */
    .chart-container { background: var(--bg); border-radius: 12px; padding: 20px; margin-bottom: 20px; }
    .chart-container canvas { width: 100%; height: 300px; }

    /* åˆ†é  */
    .pagination { display: flex; justify-content: center; align-items: center; gap: 12px; margin-top: 20px; }
    .pagination button { padding: 10px 20px; border-radius: 8px; border: 1px solid var(--border); background: #fff; cursor: pointer; font-size: 14px; font-weight: 600; transition: all 0.2s; }
    .pagination button:hover:not(:disabled) { border-color: var(--primary); background: var(--clickable); }
    .pagination button:disabled { opacity: 0.5; cursor: not-allowed; }
    .pagination .page-info { font-size: 14px; color: var(--gray); }

    /* ç©ºç‹€æ…‹ */
    .empty-state { text-align: center; padding: 60px 20px; color: var(--gray); }
    .empty-state .icon { font-size: 64px; margin-bottom: 16px; opacity: 0.5; }
    .empty-state .message { font-size: 16px; margin-bottom: 8px; }
    .empty-state .hint { font-size: 13px; opacity: 0.7; }

    /* å¿«é€Ÿç¯©é¸æŒ‰éˆ•çµ„ */
    .quick-filters { display: flex; gap: 8px; flex-wrap: wrap; margin-bottom: 16px; }
    .quick-filter { padding: 8px 16px; border-radius: 20px; font-size: 13px; font-weight: 600; cursor: pointer; border: 1px solid var(--border); background: #fff; color: var(--gray); transition: all 0.2s; display: flex; align-items: center; gap: 6px; }
    .quick-filter:hover { border-color: var(--primary); background: var(--clickable); }
    .quick-filter.active { background: var(--info); color: #fff; border-color: var(--info); }
    .quick-filter .count { background: rgba(0,0,0,0.08); padding: 2px 8px; border-radius: 10px; font-size: 11px; }
    .quick-filter.active .count { background: rgba(255,255,255,0.3); }

    /* CBASçµ±è¨ˆå€ */
    .cbas-stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 16px; margin-bottom: 20px; }
    .cbas-stat-card { background: linear-gradient(135deg, var(--cbas-bg) 0%, #ede9fe 100%); padding: 20px; border-radius: 12px; border: 1px solid var(--cbas-border); }
    .cbas-stat-card .title { font-size: 14px; font-weight: 600; color: var(--cbas-primary); margin-bottom: 12px; display: flex; align-items: center; gap: 8px; }
    .cbas-stat-card .main-value { font-size: 32px; font-weight: 800; color: var(--cbas-primary); font-family: 'Menlo', monospace; }
    .cbas-stat-card .sub-info { font-size: 13px; color: var(--gray); margin-top: 8px; }

    /* æ’è¡Œæ¦œæ¨£å¼ */
    .ranking-list { }
    .ranking-item { display: flex; align-items: center; padding: 12px 0; border-bottom: 1px solid var(--border); gap: 12px; }
    .ranking-item:last-child { border-bottom: none; }
    .ranking-num { width: 32px; height: 32px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 700; font-size: 14px; }
    .ranking-num.top1 { background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%); color: #fff; }
    .ranking-num.top2 { background: linear-gradient(135deg, #d1d5db 0%, #9ca3af 100%); color: #fff; }
    .ranking-num.top3 { background: linear-gradient(135deg, #d97706 0%, #b45309 100%); color: #fff; }
    .ranking-num.normal { background: var(--bg); color: var(--gray); }
    .ranking-info { flex: 1; }
    .ranking-info .name { font-weight: 600; color: var(--text); }
    .ranking-info .code { font-size: 12px; color: var(--gray); font-family: 'Menlo', monospace; }
    .ranking-value { text-align: right; }
    .ranking-value .main { font-size: 18px; font-weight: 700; color: var(--cbas-primary); font-family: 'Menlo', monospace; }
    .ranking-value .sub { font-size: 12px; color: var(--gray); }

    /* éŸ¿æ‡‰å¼ */
    @media(max-width: 768px) {
        .header h1 { font-size: 20px; }
        .nav-item { padding: 10px 14px; font-size: 13px; }
        .stats-cards { grid-template-columns: repeat(2, 1fr); }
        .stat-card { padding: 14px; }
        .stat-card .value { font-size: 22px; }
        .detail-grid { grid-template-columns: 1fr 1fr; }
        .hide-mobile { display: none; }
    }

    .hidden { display: none !important; }

    /* çµ±è¨ˆåˆ†æå ±å‘Šæ¨£å¼ */
    .research-nav { display: flex; gap: 8px; flex-wrap: wrap; margin-bottom: 20px; padding-bottom: 16px; border-bottom: 1px solid #f59e0b; }
    .research-tab { padding: 10px 16px; border-radius: 8px; font-size: 13px; font-weight: 600; cursor: pointer; background: #fff; color: #92400e; border: 1px solid #fcd34d; transition: all 0.2s; }
    .research-tab:hover { background: #fef3c7; }
    .research-tab.active { background: #f59e0b; color: #fff; border-color: #f59e0b; }
    
    .research-content { line-height: 1.8; color: #1e293b; }
    .research-content h2 { font-size: 20px; font-weight: 700; color: #92400e; margin: 24px 0 16px 0; padding-bottom: 8px; border-bottom: 2px solid #fcd34d; }
    .research-content h3 { font-size: 17px; font-weight: 600; color: #b45309; margin: 20px 0 12px 0; }
    .research-content p { margin: 12px 0; }
    .research-content ul { margin: 12px 0; padding-left: 24px; }
    .research-content li { margin: 8px 0; }
    
    .insight-box { background: #fff; border-radius: 12px; padding: 20px; margin: 16px 0; border-left: 4px solid #f59e0b; box-shadow: 0 2px 8px rgba(0,0,0,0.05); }
    .insight-box.warning { border-left-color: #dc2626; background: #fef2f2; }
    .insight-box.success { border-left-color: #16a34a; background: #f0fdf4; }
    .insight-box.info { border-left-color: #2563eb; background: #eff6ff; }
    .insight-box .title { font-weight: 700; font-size: 15px; margin-bottom: 8px; display: flex; align-items: center; gap: 8px; }
    .insight-box.warning .title { color: #dc2626; }
    .insight-box.success .title { color: #16a34a; }
    .insight-box.info .title { color: #2563eb; }
    
    .data-table { width: 100%; border-collapse: collapse; margin: 16px 0; font-size: 14px; background: #fff; border-radius: 8px; overflow: hidden; }
    .data-table th { background: #fef3c7; color: #92400e; padding: 12px 10px; text-align: center; font-weight: 600; }
    .data-table td { padding: 10px; border-bottom: 1px solid #fde68a; text-align: center; }
    .data-table tr:last-child td { border-bottom: none; }
    .data-table .highlight { background: #fef3c7; font-weight: 600; }
    
    .risk-indicator { display: inline-flex; align-items: center; gap: 6px; padding: 4px 12px; border-radius: 20px; font-size: 12px; font-weight: 600; }
    .risk-indicator.safe { background: #dcfce7; color: #16a34a; }
    .risk-indicator.caution { background: #fef3c7; color: #b45309; }
    .risk-indicator.warning { background: #fee2e2; color: #dc2626; }
    .risk-indicator.danger { background: #dc2626; color: #fff; }

    /* æ™ºæ…§æç¤ºæ¨£å¼ */
    .smart-tip { background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%); border: 1px solid #f59e0b; border-radius: 10px; padding: 14px 18px; margin: 12px 0; display: flex; align-items: flex-start; gap: 12px; }
    .smart-tip .icon { font-size: 20px; flex-shrink: 0; }
    .smart-tip .content { flex: 1; }
    .smart-tip .title { font-weight: 700; color: #92400e; margin-bottom: 4px; }
    .smart-tip .desc { font-size: 13px; color: #78350f; }
    .smart-tip.danger { background: linear-gradient(135deg, #fee2e2 0%, #fecaca 100%); border-color: #dc2626; }
    .smart-tip.danger .title { color: #dc2626; }
    .smart-tip.danger .desc { color: #991b1b; }
    .smart-tip.success { background: linear-gradient(135deg, #dcfce7 0%, #bbf7d0 100%); border-color: #16a34a; }
    .smart-tip.success .title { color: #16a34a; }
    .smart-tip.success .desc { color: #166534; }
</style>
```

</head>
<body>

<div class="loading" id="loading">
    <div class="spinner"></div>
    <div id="loadStatus">ç³»çµ±å•Ÿå‹•ä¸­...</div>
    <div class="load-progress"><div class="load-progress-bar" id="loadProgressBar"></div></div>
</div>

<div class="update-toast" id="updateToast"></div>

<div class="container">
    <div class="header">
        <h1><span class="icon">ğŸ“Š</span> CBASæ‹†è§£æ•´åˆç³»çµ± <span class="version">v1.0</span></h1>
        <div class="subtitle">å¯è½‰å‚µè³‡ç”¢äº¤æ›åˆ†æ Ã— åƒ¹æ ¼æ•´åˆæŸ¥è©¢ | Rexå¤§å”æŠ•è³‡ç ”ç©¶å®¤</div>
    </div>

```
<div class="main-nav" id="mainNav">
    <div class="nav-item active" onclick="setMode('overview')"><span>ğŸ“ˆ</span> ç¸½è¦½å„€è¡¨æ¿</div>
    <div class="nav-item cbas" onclick="setMode('cbas')"><span>ğŸ”„</span> CBASæ‹†è§£æŸ¥è©¢</div>
    <div class="nav-item cbas" onclick="setMode('cbasRanking')"><span>ğŸ†</span> CBASæ’è¡Œæ¦œ</div>
    <div class="nav-item" onclick="setMode('price')"><span>ğŸ’°</span> åƒ¹æ ¼æŸ¥è©¢</div>
    <div class="nav-item" onclick="setMode('kanban')"><span>ğŸ“‹</span> çœ‹æ¿è³‡è¨Š</div>
    <div class="nav-item" onclick="setMode('stock')"><span>ğŸ”</span> å€‹è‚¡æ·±åº¦åˆ†æ</div>
    <div class="nav-item" onclick="setMode('research')" style="background:linear-gradient(135deg,#fef3c7,#fde68a);border-color:#f59e0b;color:#92400e;"><span>ğŸ“š</span> çµ±è¨ˆåˆ†æå ±å‘Š</div>
</div>

<!-- ç¸½è¦½å„€è¡¨æ¿ -->
<div id="overviewSection">
    <div class="stats-cards" id="overviewStats"></div>
    
    <!-- çµ±è¨ˆæ™ºæ…§æç¤ºå€ -->
    <div class="content-section" style="background:linear-gradient(135deg,#fffbeb 0%,#fef3c7 100%);border:1px solid #f59e0b;margin-bottom:20px;">
        <div class="section-title" style="color:#92400e;margin-bottom:16px;">
            <span class="icon">ğŸ§ </span> 15å¹´çµ±è¨ˆæ™ºæ…§æç¤º
        </div>
        <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));gap:16px;">
            <div class="smart-tip success" style="margin:0;">
                <div class="icon">ğŸ›¡ï¸</div>
                <div class="content">
                    <div class="title">å®‰å…¨é‚Šéš›ï¼š110å…ƒæ˜¯é—œéµ</div>
                    <div class="desc">110å…ƒä»¥ä¸‹è²·å…¥ï¼Œè™§>10%åƒ…0.6-1.9%ï¼›ç ´åº•è²·å…¥ç²åˆ©ç‡82.1%</div>
                </div>
            </div>
            <div class="smart-tip danger" style="margin:0;">
                <div class="icon">âš ï¸</div>
                <div class="content">
                    <div class="title">é¢¨éšªè­¦ç¤ºï¼š130å…ƒæ˜¯åˆ†æ°´å¶º</div>
                    <div class="desc">130å…ƒè²·å…¥è¢«å¥—æ©Ÿç‡94.1%ï¼Œè™§>20%æ©Ÿç‡é”25%</div>
                </div>
            </div>
            <div class="smart-tip" style="margin:0;">
                <div class="icon">ğŸ¯</div>
                <div class="content">
                    <div class="title">ä¸»åŠ›å‡ºå ´å€é–“ï¼š127-145å…ƒ</div>
                    <div class="desc">é¤˜é¡æ¸›åŠæ™‚CBåƒ¹æ ¼ä¸­ä½æ•¸142å…ƒï¼Œå¯è€ƒæ…®åˆ†æ‰¹åœåˆ©</div>
                </div>
            </div>
        </div>
        <div style="text-align:right;margin-top:12px;">
            <span style="font-size:12px;color:#78350f;cursor:pointer;" onclick="setMode('research')">ğŸ“š æŸ¥çœ‹å®Œæ•´çµ±è¨ˆå ±å‘Š â†’</span>
        </div>
    </div>
    
    <div class="content-section">
        <div class="section-header">
            <div class="section-title"><span class="icon">ğŸ”¥</span> ä»Šæ—¥CBASäº¤æ˜“ç†±é–€</div>
            <div class="period-tabs">
                <div class="period-tab active" onclick="setOverviewPeriod('today')">ä»Šæ—¥</div>
                <div class="period-tab" onclick="setOverviewPeriod('week')">æœ¬é€±</div>
                <div class="period-tab" onclick="setOverviewPeriod('month')">æœ¬æœˆ</div>
            </div>
        </div>
        <div id="todayCbasRanking"></div>
    </div>

    <div class="content-section">
        <div class="section-header">
            <div class="section-title"><span class="icon">ğŸ“Š</span> CBASå¸‚å ´çµ±è¨ˆ</div>
        </div>
        <div class="cbas-stats-grid" id="cbasMarketStats"></div>
    </div>
</div>

<!-- CBASæ‹†è§£æŸ¥è©¢ -->
<div id="cbasSection" class="hidden">
    <div class="content-section">
        <div class="section-header">
            <div class="section-title"><span class="icon">ğŸ”„</span> CBASæ‹†è§£äº¤æ˜“æŸ¥è©¢</div>
            <div class="search-box">
                <input type="text" class="search-input" id="cbasSearch" placeholder="æœå°‹CBä»£è™Ÿæˆ–åç¨±...">
                <button class="search-btn" onclick="searchCbas()"><span>ğŸ”</span> æœå°‹</button>
            </div>
        </div>
        
        <div class="quick-filters" id="cbasQuickFilters">
            <div class="quick-filter active" onclick="setCbasFilter('all')">å…¨éƒ¨</div>
            <div class="quick-filter" onclick="setCbasFilter('highPremium')">ğŸ”¥ é«˜æ¬Šåˆ©é‡‘ <span class="count" id="highPremiumCount">-</span></div>
            <div class="quick-filter" onclick="setCbasFilter('highVolume')">ğŸ“Š å¤§é¡äº¤æ˜“ <span class="count" id="highVolumeCount">-</span></div>
            <div class="quick-filter" onclick="setCbasFilter('frequent')">ğŸ”„ é »ç¹äº¤æ˜“ <span class="count" id="frequentCount">-</span></div>
        </div>

        <div class="filter-tabs" style="margin-bottom:16px">
            <div class="filter-tab active" onclick="setCbasPeriod('all')">å…¨éƒ¨æœŸé–“</div>
            <div class="filter-tab" onclick="setCbasPeriod('2025')">2025</div>
            <div class="filter-tab" onclick="setCbasPeriod('2024')">2024</div>
            <div class="filter-tab" onclick="setCbasPeriod('2023')">2023</div>
            <div class="filter-tab" onclick="setCbasPeriod('2022')">2022</div>
        </div>

        <div class="table-container">
            <table>
                <thead>
                    <tr>
                        <th onclick="sortCbasTable('code')">ä»£è™Ÿ</th>
                        <th onclick="sortCbasTable('name')">åç¨±</th>
                        <th onclick="sortCbasTable('date')" class="hide-mobile">æ—¥æœŸ</th>
                        <th onclick="sortCbasTable('notional')" class="text-right">åç›®æœ¬é‡‘</th>
                        <th onclick="sortCbasTable('trades')" class="text-right">æˆäº¤ç­†æ•¸</th>
                        <th onclick="sortCbasTable('premiumAvg')" class="text-right">å¹³å‡æ¬Šåˆ©é‡‘</th>
                        <th onclick="sortCbasTable('premiumLow')" class="text-right hide-mobile">æœ€ä½æ¬Šåˆ©é‡‘</th>
                        <th onclick="sortCbasTable('premiumHigh')" class="text-right hide-mobile">æœ€é«˜æ¬Šåˆ©é‡‘</th>
                        <th onclick="sortCbasTable('term')" class="text-right">å¥‘ç´„æœŸé–“</th>
                    </tr>
                </thead>
                <tbody id="cbasTableBody"></tbody>
            </table>
        </div>
        <div class="pagination" id="cbasPagination"></div>
    </div>
</div>

<!-- CBASæ’è¡Œæ¦œ -->
<div id="cbasRankingSection" class="hidden">
    <div class="cbas-stats-grid">
        <div class="cbas-stat-card">
            <div class="title"><span>ğŸ’</span> ç´¯è¨ˆæ‹†è§£åç›®æœ¬é‡‘</div>
            <div class="main-value" id="totalNotional">-</div>
            <div class="sub-info" id="totalNotionalInfo">-</div>
        </div>
        <div class="cbas-stat-card">
            <div class="title"><span>ğŸ”„</span> ç´¯è¨ˆæ‹†è§£ç­†æ•¸</div>
            <div class="main-value" id="totalTrades">-</div>
            <div class="sub-info" id="totalTradesInfo">-</div>
        </div>
        <div class="cbas-stat-card">
            <div class="title"><span>ğŸ“Š</span> å¹³å‡æ¬Šåˆ©é‡‘</div>
            <div class="main-value" id="avgPremium">-</div>
            <div class="sub-info" id="avgPremiumInfo">-</div>
        </div>
    </div>

    <div class="content-section">
        <div class="section-header">
            <div class="section-title"><span class="icon">ğŸ†</span> åç›®æœ¬é‡‘æ’è¡Œæ¦œ</div>
            <div class="period-tabs">
                <div class="period-tab active" onclick="setRankingPeriod('all')">å…¨éƒ¨</div>
                <div class="period-tab" onclick="setRankingPeriod('2025')">2025</div>
                <div class="period-tab" onclick="setRankingPeriod('2024')">2024</div>
                <div class="period-tab" onclick="setRankingPeriod('2023')">2023</div>
            </div>
        </div>
        <div class="ranking-list" id="notionalRanking"></div>
    </div>

    <div class="content-section">
        <div class="section-header">
            <div class="section-title"><span class="icon">ğŸ”¥</span> æ¬Šåˆ©é‡‘æ’è¡Œæ¦œ</div>
        </div>
        <div class="ranking-list" id="premiumRanking"></div>
    </div>
</div>

<!-- åƒ¹æ ¼æŸ¥è©¢ -->
<div id="priceSection" class="hidden">
    <div class="content-section">
        <div class="section-header">
            <div class="section-title"><span class="icon">ğŸ’°</span> CBåƒ¹æ ¼æŸ¥è©¢</div>
            <div class="search-box">
                <input type="text" class="search-input" id="priceSearch" placeholder="æœå°‹CBä»£è™Ÿæˆ–åç¨±..." oninput="filterPriceTable()">
            </div>
        </div>

        <div class="quick-filters">
            <div class="quick-filter active" onclick="setPriceFilter('all')">å…¨éƒ¨ <span class="count" id="priceAllCount">-</span></div>
            <div class="quick-filter" onclick="setPriceFilter('discount')">ğŸ”¥ æŠ˜åƒ¹ <span class="count" id="discountCount">-</span></div>
            <div class="quick-filter" onclick="setPriceFilter('lowPremium')">ğŸ’ ä½æº¢åƒ¹ <span class="count" id="lowPremiumCount">-</span></div>
            <div class="quick-filter" onclick="setPriceFilter('hasCbas')">ğŸ”„ æœ‰CBAS <span class="count" id="hasCbasCount">-</span></div>
        </div>

        <!-- é¢¨éšªçµ±è¨ˆæç¤ºé¢æ¿ -->
        <div id="priceRiskPanel" style="background:linear-gradient(135deg,#fffbeb,#fef3c7);border:1px solid #f59e0b;border-radius:10px;padding:14px 18px;margin-bottom:16px;display:flex;flex-wrap:wrap;gap:16px;align-items:center;">
            <div style="font-weight:700;color:#92400e;display:flex;align-items:center;gap:6px;">
                <span>ğŸ“Š</span> é¢¨éšªåˆ†å¸ƒ
            </div>
            <div style="display:flex;gap:12px;flex-wrap:wrap;font-size:13px;">
                <span style="color:#16a34a;">ğŸŸ¢ å®‰å…¨å€(<110): <strong id="riskSafeCount">-</strong></span>
                <span style="color:#f59e0b;">ğŸŸ¡ è½‰æŠ˜å€(110-120): <strong id="riskCautionCount">-</strong></span>
                <span style="color:#f97316;">ğŸŸ  è­¦æˆ’å€(120-130): <strong id="riskWarningCount">-</strong></span>
                <span style="color:#dc2626;">ğŸ”´ é«˜é¢¨éšª(â‰¥130): <strong id="riskDangerCount">-</strong></span>
            </div>
            <div style="font-size:12px;color:#78350f;margin-left:auto;cursor:pointer;" onclick="setMode('research')">
                ğŸ“š æŸ¥çœ‹å®Œæ•´çµ±è¨ˆå ±å‘Š â†’
            </div>
        </div>

        <div class="table-container">
            <table>
                <thead>
                    <tr>
                        <th onclick="sortPriceTable('code')">ä»£è™Ÿ</th>
                        <th onclick="sortPriceTable('name')">åç¨±</th>
                        <th onclick="sortPriceTable('close')" class="text-right">æ”¶ç›¤åƒ¹</th>
                        <th onclick="sortPriceTable('change')" class="text-right">æ¼²è·Œ</th>
                        <th onclick="sortPriceTable('changePct')" class="text-right">æ¼²è·Œ%</th>
                        <th onclick="sortPriceTable('close')" class="text-center" title="æ ¹æ“š15å¹´çµ±è¨ˆæ•¸æ“šçš„é¢¨éšªè©•ä¼°">é¢¨éšªç­‰ç´š</th>
                        <th onclick="sortPriceTable('high')" class="text-right hide-mobile">æœ€é«˜</th>
                        <th onclick="sortPriceTable('low')" class="text-right hide-mobile">æœ€ä½</th>
                        <th class="text-center">CBAS</th>
                    </tr>
                </thead>
                <tbody id="priceTableBody"></tbody>
            </table>
        </div>
        <div class="pagination" id="pricePagination"></div>
    </div>
</div>

<!-- çœ‹æ¿è³‡è¨Š -->
<div id="kanbanSection" class="hidden">
    <div class="content-section">
        <div class="section-header">
            <div class="section-title"><span class="icon">ğŸ“‹</span> CBçœ‹æ¿è³‡è¨Š</div>
            <div class="search-box">
                <input type="text" class="search-input" id="kanbanSearch" placeholder="æœå°‹CBä»£è™Ÿæˆ–åç¨±..." oninput="filterKanbanTable()">
            </div>
        </div>

        <div class="table-container">
            <table>
                <thead>
                    <tr>
                        <th onclick="sortKanbanTable('code')">ä»£è™Ÿ</th>
                        <th onclick="sortKanbanTable('name')">åç¨±</th>
                        <th onclick="sortKanbanTable('convPrice')" class="text-right">è½‰æ›åƒ¹</th>
                        <th onclick="sortKanbanTable('convStart')" class="hide-mobile">è½‰æ›èµ·æ—¥</th>
                        <th onclick="sortKanbanTable('convEnd')" class="hide-mobile">è½‰æ›è¿„æ—¥</th>
                        <th onclick="sortKanbanTable('putDate')" class="hide-mobile">è³£å›æ¬Šæ—¥</th>
                        <th onclick="sortKanbanTable('putPrice')" class="text-right hide-mobile">è³£å›åƒ¹æ ¼</th>
                        <th onclick="sortKanbanTable('balance')" class="text-right">ç™¼è¡Œé¤˜é¡</th>
                        <th onclick="sortKanbanTable('cbPrice')" class="text-right">è½‰å‚µåƒ¹æ ¼</th>
                        <th onclick="sortKanbanTable('stockPrice')" class="text-right">è‚¡ç¥¨åƒ¹æ ¼</th>
                    </tr>
                </thead>
                <tbody id="kanbanTableBody"></tbody>
            </table>
        </div>
        <div class="pagination" id="kanbanPagination"></div>
    </div>
</div>

<!-- å€‹è‚¡æ·±åº¦åˆ†æ -->
<div id="stockSection" class="hidden">
    <div class="content-section">
        <div class="section-header">
            <div class="section-title"><span class="icon">ğŸ”</span> å€‹è‚¡æ·±åº¦åˆ†æ</div>
            <div class="search-box">
                <input type="text" class="search-input" id="stockCodeInput" placeholder="è¼¸å…¥CBä»£è™Ÿï¼Œä¾‹å¦‚ï¼š49232" onkeyup="if(event.key==='Enter')loadStockAnalysis()">
                <button class="search-btn" onclick="loadStockAnalysis()"><span>ğŸ”</span> åˆ†æ</button>
            </div>
        </div>
        <div id="stockAnalysisResult">
            <div class="empty-state">
                <div class="icon">ğŸ”</div>
                <div class="message">è¼¸å…¥CBä»£è™Ÿé€²è¡Œæ·±åº¦åˆ†æ</div>
                <div class="hint">æ•´åˆCBASæ‹†è§£ã€åƒ¹æ ¼èµ°å‹¢ã€çœ‹æ¿è³‡è¨Šçš„å®Œæ•´åˆ†æ</div>
            </div>
        </div>
    </div>
</div>

<!-- çµ±è¨ˆåˆ†æå ±å‘Š -->
<div id="researchSection" class="hidden">
    <div class="content-section" style="background:linear-gradient(135deg,#fffbeb 0%,#fef3c7 100%);border:1px solid #f59e0b;">
        <div class="section-title" style="color:#92400e;margin-bottom:20px;">
            <span class="icon">ğŸ“š</span> CBåƒ¹æ ¼é¢¨éšªåŸºç¤ç³»åˆ— - çµ±è¨ˆåˆ†æå ±å‘Š
        </div>
        <div class="research-nav">
            <div class="research-tab active" onclick="setResearchTab('summary')">ğŸ“Š æ™ºæ…§æ‘˜è¦</div>
            <div class="research-tab" onclick="setResearchTab('report1')">å°ˆé¡Œ1-1 å„åƒ¹ä½é¢¨éšªå…¨æ™¯</div>
            <div class="research-tab" onclick="setResearchTab('report2')">å°ˆé¡Œ1-2 130å…ƒè‡¨ç•Œé»</div>
            <div class="research-tab" onclick="setResearchTab('report3')">å°ˆé¡Œ1-3 é«˜åƒ¹å€é–“é¢¨éšª</div>
            <div class="research-tab" onclick="setResearchTab('report4')">å°ˆé¡Œ1-4 ä½åƒ¹å®‰å…¨é‚Šéš›</div>
            <div class="research-tab" onclick="setResearchTab('report5')">å°ˆé¡Œ1-2-1 CBASä¸»åŠ›è¿½è¹¤</div>
        </div>
        <div id="researchContent"></div>
    </div>
</div>
```

</div>

<!-- è©³ç´°è³‡æ–™å½ˆçª— -->

<div class="modal" id="detailModal" onclick="if(event.target===this)closeModal()">
    <div class="modal-content">
        <div class="modal-header">
            <h3 id="modalTitle"><span>ğŸ“Š</span> CBè©³ç´°è³‡æ–™</h3>
            <button class="modal-close" onclick="closeModal()">âœ•</button>
        </div>
        <div class="modal-body" id="modalBody"></div>
    </div>
</div>

<script>
// ==================== å…¨åŸŸè®Šæ•¸ ====================
const DB = {
    cbas: {},           // CBASæ‹†è§£è³‡æ–™ {code: [{date, notional, trades, premiumLow, premiumHigh, premiumAvg, term}]}
    cbasDaily: {},      // æ¯æ—¥CBASå½™ç¸½ {dateNum: [{code, name, ...}]}
    price: {},          // åƒ¹æ ¼è³‡æ–™ {code: [{date, open, high, low, close, change, volume}]}
    priceLatest: {},    // æœ€æ–°åƒ¹æ ¼ {code: {date, close, change, ...}}
    kanban: {},         // çœ‹æ¿è³‡æ–™ {code: {convPrice, convStart, convEnd, ...}}
    kanbanLatest: {},   // æœ€æ–°çœ‹æ¿ {code: {...}}
    cbInfo: {},         // CBåŸºæœ¬è³‡æ–™
    nameToCode: {},     // åç¨±åˆ°ä»£è™Ÿå°ç…§è¡¨
    listedCodes: new Set()
};

const META = {
    cbasYearsLoaded: {},
    priceYearsLoaded: {},
    kanbanYearsLoaded: {},
    latestCbasDate: null,
    latestPriceDate: null
};

let MODE = 'overview';
let CBAS_FILTER = 'all';
let CBAS_PERIOD = 'all';
let CBAS_SORT = { field: 'date', dir: 'desc' };
let CBAS_PAGE = { current: 1, size: 50 };

let PRICE_FILTER = 'all';
let PRICE_SORT = { field: 'code', dir: 'asc' };
let PRICE_PAGE = { current: 1, size: 50 };

let KANBAN_SORT = { field: 'code', dir: 'asc' };
let KANBAN_PAGE = { current: 1, size: 50 };

let OVERVIEW_PERIOD = 'today';
let RANKING_PERIOD = 'all';

const currentYear = new Date().getFullYear();

// ==================== åˆå§‹åŒ– ====================
async function init() {
    try {
        updateLoadStatus('è¼‰å…¥åŸºæœ¬è³‡æ–™...', 5);
        await loadCbInfo();
        
        updateLoadStatus('è¼‰å…¥CBASè³‡æ–™...', 20);
        await loadCbasData([currentYear, currentYear - 1]);
        
        updateLoadStatus('è¼‰å…¥åƒ¹æ ¼è³‡æ–™...', 50);
        await loadPriceData([currentYear]);
        
        updateLoadStatus('è¼‰å…¥çœ‹æ¿è³‡æ–™...', 80);
        await loadKanbanData([currentYear]);
        
        // ç”¨çœ‹æ¿çš„è½‰å‚µåƒè€ƒåƒ¹æ ¼è£œå…… priceLatest
        updateLoadStatus('æ•´åˆè³‡æ–™...', 95);
        for (const code of DB.listedCodes) {
            const kanban = DB.kanbanLatest[code];
            if (kanban && kanban.cbPrice > 0 && !DB.priceLatest[code]) {
                DB.priceLatest[code] = {
                    date: '-',
                    dateNum: 0,
                    code,
                    name: kanban.name || DB.cbInfo[code]?.name || code,
                    open: kanban.cbPrice,
                    high: kanban.cbPrice,
                    low: kanban.cbPrice,
                    close: kanban.cbPrice,
                    change: 0,
                    volume: 0
                };
            }
        }
        
        updateLoadStatus('åˆå§‹åŒ–å®Œæˆ', 100);
        console.log(`æœ€çµ‚è³‡æ–™: åƒ¹æ ¼${Object.keys(DB.priceLatest).length}æª”, çœ‹æ¿${Object.keys(DB.kanbanLatest).length}æª”`);
        
        setTimeout(() => {
            document.getElementById('loading').classList.add('hidden');
            renderOverview();
        }, 300);
    } catch(e) {
        console.error('åˆå§‹åŒ–å¤±æ•—:', e);
        updateLoadStatus('è¼‰å…¥å¤±æ•—: ' + e.message, 0);
    }
}

function updateLoadStatus(msg, progress) {
    document.getElementById('loadStatus').textContent = msg;
    document.getElementById('loadProgressBar').style.width = progress + '%';
}

function showToast(msg) {
    const t = document.getElementById('updateToast');
    t.textContent = msg;
    t.classList.add('show');
    setTimeout(() => t.classList.remove('show'), 3000);
}

// ==================== è³‡æ–™è¼‰å…¥ ====================
// æ­£è¦åŒ–åç¨±ï¼šè™•ç† K/KY å·®ç•°ã€ç©ºæ ¼ç­‰
function normalizeName(name) {
    if (!name) return '';
    let n = String(name).trim();
    // çµ±ä¸€ KY æ ¼å¼
    n = n.replace(/[-]?KY$/i, 'KY').replace(/[-]?K$/i, 'K');
    // ç§»é™¤ç©ºæ ¼
    n = n.replace(/\s+/g, '');
    return n;
}

async function loadCbInfo() {
    try {
        const res = await fetch('00_CB.xlsx');
        if (!res.ok) return;
        const wb = XLSX.read(await res.arrayBuffer(), { type: 'array', cellDates: true });
        
        // 1. è¼‰å…¥CBåŸºæœ¬è³‡æ–™ (01_ALLCBåŸºæœ¬è³‡æ–™)
        const basicSheet = wb.SheetNames.find(n => n.includes('ALLCBåŸºæœ¬è³‡æ–™'));
        if (basicSheet && wb.Sheets[basicSheet]) {
            XLSX.utils.sheet_to_json(wb.Sheets[basicSheet]).forEach(r => {
                const code = String(r['CBä»£è™Ÿ'] || '').trim();
                if (!code || code.length < 4) return;
                
                const name = r['åç¨±'] || '';
                DB.cbInfo[code] = {
                    name,
                    stockCode: String(r['è‚¡ç¥¨ä»£è™Ÿ'] || '').replace(/\.0$/, ''),
                    stockName: '',
                    industry: r['ç”¢æ¥­åˆ†é¡'] || '',
                    guarantee: r['æ“”ä¿'] || 'ç„¡æ“”ä¿',
                    creditRating: r['ä¿¡ç”¨è©•ç­‰'] || '',
                    issueSize: parseFloat(r['ç™¼è¡Œè¦æ¨¡']) || 0,
                    convPrice: parseFloat(r['è½‰æ›åƒ¹æ ¼']) || 0,
                    listDate: r['æ›ç‰Œæ—¥æœŸ'] || '',
                    maturityDate: r['åˆ°æœŸæ—¥æœŸ'] || '',
                    highPrice: parseFloat(r['æ›ç‰Œæœ€é«˜']) || 0,
                    lowPrice: parseFloat(r['æ›ç‰Œæœ€ä½']) || 0
                };
                
                // å»ºç«‹åç¨±å°ç…§è¡¨ï¼ˆå¤šç¨®è®Šé«”ï¼‰
                if (name) {
                    DB.nameToCode[name] = code;
                    DB.nameToCode[normalizeName(name)] = code;
                    // è™•ç† K å’Œ KY äº’æ›
                    if (name.endsWith('K')) {
                        DB.nameToCode[name + 'Y'] = code;
                    } else if (name.endsWith('KY')) {
                        DB.nameToCode[name.slice(0, -1)] = code;
                    }
                }
            });
        }
        
        // 2. è¼‰å…¥ç”¢æ¥­åˆ†é¡è£œå…… (16_ç”¢æ¥­åˆ†é¡)
        const industrySheet = wb.SheetNames.find(n => n.includes('ç”¢æ¥­åˆ†é¡'));
        if (industrySheet && wb.Sheets[industrySheet]) {
            XLSX.utils.sheet_to_json(wb.Sheets[industrySheet]).forEach(r => {
                const code = String(r['CBä»£è™Ÿ'] || '').trim();
                if (code && DB.cbInfo[code]) {
                    DB.cbInfo[code].industry = r['ç”¢æ¥­'] || DB.cbInfo[code].industry;
                }
            });
        }
        
        // 3. è¼‰å…¥æ›ç‰Œä¸­æ¸…å–®åŠæœ€æ–°è³‡æ–™ (08_æœ€æ–°å‹•æ…‹æ¯é€±åŸºæœ¬è³‡æ–™)
        const listSheet = wb.SheetNames.find(n => n.includes('æœ€æ–°å‹•æ…‹æ¯é€±åŸºæœ¬è³‡æ–™'));
        if (listSheet && wb.Sheets[listSheet]) {
            XLSX.utils.sheet_to_json(wb.Sheets[listSheet]).forEach(r => {
                const code = String(r['ä»£è™Ÿ'] || '').trim();
                if (!code) return;
                
                DB.listedCodes.add(code);
                
                const name = r['åç¨±'] || '';
                
                // åŒæ™‚æ›´æ–°/å»ºç«‹åŸºæœ¬è³‡æ–™å’Œçœ‹æ¿è³‡æ–™
                if (!DB.cbInfo[code]) {
                    DB.cbInfo[code] = { name: '', stockCode: '', stockName: '', industry: '', guarantee: '' };
                }
                DB.cbInfo[code].name = name || DB.cbInfo[code].name;
                DB.cbInfo[code].stockCode = String(r['è½‰æ›æ¨™çš„ä»£ç¢¼'] || '').replace(/\.0$/, '');
                DB.cbInfo[code].stockName = r['è½‰æ›æ¨™çš„åç¨±'] || '';
                
                // è£œå……åç¨±å°ç…§è¡¨
                if (name) {
                    DB.nameToCode[name] = code;
                    DB.nameToCode[normalizeName(name)] = code;
                }
                
                // æ ¼å¼åŒ–æ—¥æœŸ
                const formatDate = (val) => {
                    if (!val) return '-';
                    if (val instanceof Date) return val.toISOString().slice(0, 10);
                    return String(val).slice(0, 10);
                };
                
                // æ›´æ–°çœ‹æ¿è³‡æ–™
                DB.kanbanLatest[code] = {
                    code,
                    name: name || DB.cbInfo[code].name || code,
                    convStart: formatDate(r['è½‰æ›æ—¥æœŸèµ·']),
                    convEnd: formatDate(r['è½‰æ›æ—¥æœŸè¿„']),
                    convPrice: parseFloat(r['è½‰æ›åƒ¹æ ¼(å…ƒ)']) || 0,
                    putDate: formatDate(r['æœ€è¿‘æå‰å„Ÿé‚„æ—¥']),
                    putPrice: parseFloat(r['æœ€è¿‘æå‰å„Ÿé‚„åƒ¹æ ¼']) || 0,
                    issueAmount: parseFloat(r['å¯¦éš›ç™¼è¡Œç¸½é¡(ç™¾è¬)']) * 1000000 || 0,
                    balance: parseFloat(r['æœ€æ–°é¤˜é¡(ç™¾è¬)']) * 1000000 || 0,
                    maturityDate: formatDate(r['åˆ°æœŸæ—¥']),
                    maturityPrice: parseFloat(r['åˆ°æœŸåƒ¹æ ¼']) || 100,
                    couponRate: parseFloat(r['ç¥¨é¢åˆ©ç‡']) || 0,
                    listDate: formatDate(r['æ›ç‰Œæ—¥æœŸ']),
                    issueDate: formatDate(r['ç™¼è¡Œæ—¥æœŸ'])
                };
            });
        }
        
        console.log(`è¼‰å…¥CBåŸºæœ¬è³‡æ–™: ${Object.keys(DB.cbInfo).length}æª”, æ›ç‰Œä¸­: ${DB.listedCodes.size}æª”, åç¨±å°ç…§: ${Object.keys(DB.nameToCode).length}ç­†`);
    } catch(e) {
        console.error('è¼‰å…¥CBåŸºæœ¬è³‡æ–™å¤±æ•—:', e);
    }
}

async function loadCbasData(years) {
    for (const year of years) {
        if (META.cbasYearsLoaded[year]) continue;
        try {
            const res = await fetch(`data/CBAS/CBAS_${year}.xlsx`);
            if (!res.ok) continue;
            const wb = XLSX.read(await res.arrayBuffer(), { type: 'array' });
            
            wb.SheetNames.forEach(sheetName => {
                if (!/^\d{8}$/.test(sheetName.trim())) return;
                const dateStr = sheetName.trim();
                const dateNum = parseInt(dateStr);
                const formattedDate = `${dateStr.substring(0,4)}/${dateStr.substring(4,6)}/${dateStr.substring(6,8)}`;
                
                // skiprows=3 å¾Œè®€å–è³‡æ–™
                const data = XLSX.utils.sheet_to_json(wb.Sheets[sheetName], { range: 3 });
                
                data.forEach((row) => {
                    // ä½¿ç”¨å¯¦éš›æ¬„ä½åç¨±
                    const vals = Object.values(row);
                    const code = String(vals[0] || '').trim();
                    if (!code || code.length < 4 || !code[0].match(/\d/)) return;
                    
                    const name = String(vals[1] || '').trim();
                    const notional = parseFloat(String(vals[2] || '0').replace(/,/g, '')) || 0;
                    const trades = parseInt(vals[3]) || 0;
                    const premiumLow = parseFloat(vals[4]) || 0;
                    const premiumHigh = parseFloat(vals[5]) || premiumLow;
                    const premiumAvg = parseFloat(vals[6]) || premiumLow;
                    const term = parseInt(vals[7]) || 0;
                    
                    if (notional <= 0) return;
                    
                    const record = {
                        date: formattedDate,
                        dateNum,
                        code,
                        name: name || DB.cbInfo[code]?.name || code,
                        notional,
                        trades,
                        premiumLow,
                        premiumHigh,
                        premiumAvg,
                        term
                    };
                    
                    if (!DB.cbas[code]) DB.cbas[code] = [];
                    DB.cbas[code].push(record);
                    
                    if (!DB.cbasDaily[dateNum]) DB.cbasDaily[dateNum] = [];
                    DB.cbasDaily[dateNum].push(record);
                    
                    // æ›´æ–°æœ€æ–°æ—¥æœŸ
                    if (!META.latestCbasDate || dateNum > META.latestCbasDate) {
                        META.latestCbasDate = dateNum;
                    }
                });
            });
            
            META.cbasYearsLoaded[year] = true;
        } catch(e) {
            console.error(`è¼‰å…¥CBAS ${year}è³‡æ–™å¤±æ•—:`, e);
        }
    }
}

async function loadPriceData(years) {
    for (const year of years) {
        if (META.priceYearsLoaded[year]) continue;
        try {
            const res = await fetch(`data/cbprice/CB_price_${year}.xlsx`);
            if (!res.ok) continue;
            const wb = XLSX.read(await res.arrayBuffer(), { type: 'array' });
            
            // æ‰¾æ‰€æœ‰æ—¥æœŸå·¥ä½œè¡¨ä¸¦æŒ‰æ—¥æœŸæ’åºï¼ˆå¾æ–°åˆ°èˆŠï¼‰
            const dateSheets = wb.SheetNames.filter(n => /^\d{8}$/.test(n.trim())).sort().reverse();
            
            for (const sheetName of dateSheets) {
                const dateStr = sheetName.trim();
                const dateNum = parseInt(dateStr);
                const formattedDate = `${dateStr.substring(0,4)}/${dateStr.substring(4,6)}/${dateStr.substring(6,8)}`;
                
                // å…ˆè®€å–åŸå§‹è³‡æ–™æª¢æŸ¥æ˜¯å¦æœ‰æ¨™é¡Œè¡Œ
                const rawData = XLSX.utils.sheet_to_json(wb.Sheets[sheetName], { header: 1 });
                if (rawData.length === 0) continue;
                
                // æª¢æŸ¥ç¬¬ä¸€è¡Œæ˜¯å¦ç‚ºæ¨™é¡Œï¼ˆåŒ…å«'ä»£è™Ÿ'ï¼‰
                const firstRow = rawData[0];
                const hasHeader = firstRow && String(firstRow[0]) === 'ä»£è™Ÿ';
                
                // è™•ç†æœ‰æ¨™é¡Œè¡Œçš„æƒ…æ³
                if (hasHeader) {
                    XLSX.utils.sheet_to_json(wb.Sheets[sheetName]).forEach(row => {
                        const code = String(row['ä»£è™Ÿ'] || '').trim();
                        if (!code || code.length < 4) return;
                        
                        let close = parseFloat(row['æ”¶å¸‚']);
                        if (isNaN(close) || close <= 0) {
                            close = parseFloat(row['æ˜æ—¥åƒåƒ¹']) || 0;
                        }
                        if (close <= 0) return;
                        
                        const name = row['åç¨±'] || DB.cbInfo[code]?.name || code;
                        const record = {
                            date: formattedDate,
                            dateNum,
                            code,
                            name,
                            open: parseFloat(row['é–‹å¸‚']) || close,
                            high: parseFloat(row['æœ€é«˜']) || close,
                            low: parseFloat(row['æœ€ä½']) || close,
                            close,
                            change: parseFloat(row['æ¼²è·Œ']) || 0,
                            volume: parseFloat(row['å–®ä½']) || 0
                        };
                        
                        if (!DB.price[code]) DB.price[code] = [];
                        DB.price[code].push(record);
                        
                        if (!DB.priceLatest[code] || dateNum > DB.priceLatest[code].dateNum) {
                            DB.priceLatest[code] = { ...record };
                        }
                        
                        // è£œå……åç¨±å°ç…§è¡¨
                        if (name) {
                            DB.nameToCode[name] = code;
                            DB.nameToCode[normalizeName(name)] = code;
                        }
                    });
                } else {
                    // è™•ç†ç„¡æ¨™é¡Œè¡Œçš„æƒ…æ³ï¼šç¬¬ä¸€æ¬„æ˜¯åç¨±
                    // æ¬„ä½: 0=åç¨±, 1=æ”¶å¸‚, 2=æ¼²è·Œ, 3=é–‹å¸‚, 4=æœ€é«˜, 5=æœ€ä½, 6=ç­†æ•¸, 7=å–®ä½, 8=é‡‘é¡, 9=æ˜æ—¥åƒåƒ¹
                    rawData.forEach(row => {
                        const name = String(row[0] || '').trim();
                        if (!name || name === 'ä»£è™Ÿ' || name === 'åç¨±') return;
                        
                        // ç”¨åç¨±åæŸ¥ä»£è™Ÿ
                        let code = DB.nameToCode[name] || DB.nameToCode[normalizeName(name)];
                        
                        // å¦‚æœé‚„æ˜¯æ‰¾ä¸åˆ°ï¼Œå˜—è©¦æ›´å¤šè®Šé«”
                        if (!code) {
                            // å˜—è©¦å»æ‰æˆ–åŠ ä¸Š KY
                            if (name.endsWith('KY')) {
                                code = DB.nameToCode[name.slice(0, -1)] || DB.nameToCode[name.slice(0, -2) + 'K'];
                            } else if (name.endsWith('K')) {
                                code = DB.nameToCode[name + 'Y'];
                            }
                        }
                        
                        if (!code) return;
                        
                        let close = parseFloat(row[1]);
                        if (isNaN(close) || close <= 0) {
                            close = parseFloat(row[9]) || 0;  // æ˜æ—¥åƒåƒ¹
                        }
                        if (close <= 0) return;
                        
                        const record = {
                            date: formattedDate,
                            dateNum,
                            code,
                            name: DB.cbInfo[code]?.name || name,
                            open: parseFloat(row[3]) || close,
                            high: parseFloat(row[4]) || close,
                            low: parseFloat(row[5]) || close,
                            close,
                            change: parseFloat(row[2]) || 0,
                            volume: parseFloat(row[7]) || 0
                        };
                        
                        if (!DB.price[code]) DB.price[code] = [];
                        DB.price[code].push(record);
                        
                        if (!DB.priceLatest[code] || dateNum > DB.priceLatest[code].dateNum) {
                            DB.priceLatest[code] = { ...record };
                        }
                    });
                }
                
                if (!META.latestPriceDate || dateNum > META.latestPriceDate) {
                    META.latestPriceDate = dateNum;
                }
            }
            
            META.priceYearsLoaded[year] = true;
            console.log(`è¼‰å…¥åƒ¹æ ¼è³‡æ–™ ${year}: ${dateSheets.length}å€‹äº¤æ˜“æ—¥, å…±${Object.keys(DB.priceLatest).length}æª”`);
        } catch(e) {
            console.error(`è¼‰å…¥åƒ¹æ ¼ ${year}è³‡æ–™å¤±æ•—:`, e);
        }
    }
}

async function loadKanbanData(years) {
    for (const year of years) {
        if (META.kanbanYearsLoaded[year]) continue;
        try {
            const res = await fetch(`data/Kanban/CB_kanban_${year}.xlsx`);
            if (!res.ok) continue;
            const wb = XLSX.read(await res.arrayBuffer(), { type: 'array', cellDates: true });
            
            // æ‰¾æœ€æ–°çš„æ—¥æœŸå·¥ä½œè¡¨
            const dateSheets = wb.SheetNames.filter(n => /^\d{8}$/.test(n.trim())).sort().reverse();
            if (dateSheets.length === 0) continue;
            
            const latestSheet = dateSheets[0];
            const latestDateNum = parseInt(latestSheet);
            
            XLSX.utils.sheet_to_json(wb.Sheets[latestSheet]).forEach(row => {
                const code = String(row['å‚µåˆ¸ä»£ç¢¼'] || '').trim();
                if (!code || code.length < 4) return;
                
                // è™•ç†æ—¥æœŸæ ¼å¼
                const formatDate = (val) => {
                    if (!val) return '-';
                    if (val instanceof Date) {
                        return val.toISOString().slice(0, 10);
                    }
                    return String(val).slice(0, 10);
                };
                
                const record = {
                    code,
                    name: row['å‚µåˆ¸ç°¡ç¨±'] || DB.cbInfo[code]?.name || code,
                    convStart: formatDate(row['è½‰æ›èµ·æ—¥']),
                    convEnd: formatDate(row['è½‰æ›è¿„æ—¥']),
                    convPrice: parseFloat(row['è½‰æ›åƒ¹æ ¼']) || 0,
                    putDate: formatDate(row['æœ€è¿‘è³£å›æ¬Šèµ·æ—¥']),
                    putPrice: parseFloat(row['æœ€è¿‘è³£å›æ¬Šåƒ¹æ ¼']) || 0,
                    forceRedeemStart: formatDate(row['å¼·åˆ¶è´–å›èµ·æ—¥']),
                    forceRedeemEnd: formatDate(row['å¼·åˆ¶è´–å›è¿„æ—¥']),
                    forceRedeemPrice: parseFloat(row['å¼·åˆ¶è´–å›åƒ¹æ ¼']) || 0,
                    issueAmount: parseFloat(row['åŸå§‹ç™¼è¡Œç¸½é¡']) || 0,
                    balance: parseFloat(row['ä¸Šæœˆåº•ç™¼è¡Œé¤˜é¡']) || 0,
                    cbPrice: parseFloat(row['è½‰å‚µåƒè€ƒåƒ¹æ ¼']) || 0,
                    stockPrice: parseFloat(row['è½‰æ›æ¨™çš„è‚¡ç¥¨åƒ¹æ ¼']) || 0,
                    couponRate: parseFloat(row['ç¥¨é¢åˆ©ç‡']) || 0,
                    dateNum: latestDateNum
                };
                
                // åªæ›´æ–°è¼ƒæ–°çš„è³‡æ–™
                if (!DB.kanbanLatest[code] || latestDateNum > (DB.kanbanLatest[code].dateNum || 0)) {
                    // ä¿ç•™ 00_CB.xlsx çš„è£œå……è³‡æ–™
                    const existing = DB.kanbanLatest[code] || {};
                    DB.kanbanLatest[code] = {
                        ...existing,
                        ...record,
                        // å¦‚æœçœ‹æ¿æ²’æœ‰æŸäº›æ¬„ä½ï¼Œä¿ç•™åŸæœ‰çš„
                        maturityDate: existing.maturityDate || '-',
                        maturityPrice: existing.maturityPrice || 100,
                        listDate: existing.listDate || '-',
                        issueDate: existing.issueDate || '-'
                    };
                }
                
                // åŒæ­¥æ›´æ–° cbInfo
                if (!DB.cbInfo[code]) {
                    DB.cbInfo[code] = { name: record.name, stockCode: '', stockName: '', industry: '', guarantee: '' };
                } else {
                    DB.cbInfo[code].name = DB.cbInfo[code].name || record.name;
                }
            });
            
            META.kanbanYearsLoaded[year] = true;
            console.log(`è¼‰å…¥çœ‹æ¿è³‡æ–™ ${year}: ${latestSheet}`);
        } catch(e) {
            console.error(`è¼‰å…¥çœ‹æ¿ ${year}è³‡æ–™å¤±æ•—:`, e);
        }
    }
}

// ==================== æ¨¡å¼åˆ‡æ› ====================
function setMode(mode) {
    MODE = mode;
    document.querySelectorAll('.nav-item').forEach(el => {
        el.classList.remove('active');
        if (el.textContent.includes(getModeLabel(mode))) el.classList.add('active');
    });
    
    document.getElementById('overviewSection').classList.toggle('hidden', mode !== 'overview');
    document.getElementById('cbasSection').classList.toggle('hidden', mode !== 'cbas');
    document.getElementById('cbasRankingSection').classList.toggle('hidden', mode !== 'cbasRanking');
    document.getElementById('priceSection').classList.toggle('hidden', mode !== 'price');
    document.getElementById('kanbanSection').classList.toggle('hidden', mode !== 'kanban');
    document.getElementById('stockSection').classList.toggle('hidden', mode !== 'stock');
    document.getElementById('researchSection').classList.toggle('hidden', mode !== 'research');
    
    switch(mode) {
        case 'overview': renderOverview(); break;
        case 'cbas': renderCbasTable(); break;
        case 'cbasRanking': renderCbasRanking(); break;
        case 'price': renderPriceTable(); break;
        case 'kanban': renderKanbanTable(); break;
        case 'research': renderResearchContent('summary'); break;
    }
}

function getModeLabel(mode) {
    const labels = {
        overview: 'ç¸½è¦½', cbas: 'CBASæ‹†è§£æŸ¥è©¢', cbasRanking: 'CBASæ’è¡Œæ¦œ',
        price: 'åƒ¹æ ¼æŸ¥è©¢', kanban: 'çœ‹æ¿è³‡è¨Š', stock: 'å€‹è‚¡æ·±åº¦', research: 'çµ±è¨ˆåˆ†æ'
    };
    return labels[mode] || '';
}

// ==================== ç¸½è¦½å„€è¡¨æ¿ ====================
function renderOverview() {
    // çµ±è¨ˆå¡ç‰‡
    const totalCbasRecords = Object.values(DB.cbas).reduce((sum, arr) => sum + arr.length, 0);
    const totalNotional = Object.values(DB.cbas).flat().reduce((sum, r) => sum + r.notional, 0);
    const uniqueCbasCodes = Object.keys(DB.cbas).length;
    const listedCount = DB.listedCodes.size;
    
    document.getElementById('overviewStats').innerHTML = `
        <div class="stat-card cbas">
            <div class="icon">ğŸ”„</div>
            <div class="value">${totalCbasRecords.toLocaleString()}</div>
            <div class="label">CBASäº¤æ˜“ç­†æ•¸</div>
        </div>
        <div class="stat-card cbas">
            <div class="icon">ğŸ’</div>
            <div class="value">${formatNotional(totalNotional)}</div>
            <div class="label">ç´¯è¨ˆåç›®æœ¬é‡‘</div>
        </div>
        <div class="stat-card cbas">
            <div class="icon">ğŸ“Š</div>
            <div class="value">${uniqueCbasCodes}</div>
            <div class="label">æœ‰CBASäº¤æ˜“çš„CB</div>
        </div>
        <div class="stat-card">
            <div class="icon">ğŸ“ˆ</div>
            <div class="value">${listedCount}</div>
            <div class="label">æ›ç‰Œä¸­CB</div>
        </div>
        <div class="stat-card">
            <div class="icon">ğŸ’°</div>
            <div class="value">${Object.keys(DB.priceLatest).length}</div>
            <div class="label">æœ‰åƒ¹æ ¼è³‡æ–™</div>
        </div>
        <div class="stat-card">
            <div class="icon">ğŸ“‹</div>
            <div class="value">${Object.keys(DB.kanbanLatest).length}</div>
            <div class="label">çœ‹æ¿è³‡æ–™</div>
        </div>
    `;
    
    // ä»Šæ—¥/æœ¬é€±CBASæ’è¡Œ
    renderTodayCbasRanking();
    
    // å¸‚å ´çµ±è¨ˆ
    renderCbasMarketStats();
}

function setOverviewPeriod(period) {
    OVERVIEW_PERIOD = period;
    document.querySelectorAll('#overviewSection .period-tab').forEach(el => {
        el.classList.toggle('active', el.textContent.includes(
            period === 'today' ? 'ä»Šæ—¥' : period === 'week' ? 'æœ¬é€±' : 'æœ¬æœˆ'
        ));
    });
    renderTodayCbasRanking();
}

function renderTodayCbasRanking() {
    let records = [];
    
    if (OVERVIEW_PERIOD === 'today' && META.latestCbasDate) {
        records = DB.cbasDaily[META.latestCbasDate] || [];
    } else {
        // æœ¬é€±æˆ–æœ¬æœˆ
        const now = new Date();
        let cutoff;
        if (OVERVIEW_PERIOD === 'week') {
            cutoff = new Date(now.setDate(now.getDate() - 7));
        } else {
            cutoff = new Date(now.setMonth(now.getMonth() - 1));
        }
        const cutoffNum = parseInt(cutoff.toISOString().slice(0,10).replace(/-/g, ''));
        
        Object.values(DB.cbasDaily).forEach(dayRecords => {
            dayRecords.forEach(r => {
                if (r.dateNum >= cutoffNum) records.push(r);
            });
        });
    }
    
    // å½™ç¸½åŒä¸€CBçš„è³‡æ–™
    const summary = {};
    records.forEach(r => {
        if (!summary[r.code]) {
            summary[r.code] = { code: r.code, name: r.name, notional: 0, trades: 0, premiumSum: 0, count: 0 };
        }
        summary[r.code].notional += r.notional;
        summary[r.code].trades += r.trades;
        summary[r.code].premiumSum += r.premiumAvg * r.trades;
        summary[r.code].count += r.trades;
    });
    
    const sorted = Object.values(summary).sort((a, b) => b.notional - a.notional).slice(0, 10);
    
    if (sorted.length === 0) {
        document.getElementById('todayCbasRanking').innerHTML = `
            <div class="empty-state">
                <div class="icon">ğŸ“­</div>
                <div class="message">è©²æœŸé–“ç„¡CBASäº¤æ˜“è³‡æ–™</div>
            </div>
        `;
        return;
    }
    
    document.getElementById('todayCbasRanking').innerHTML = `
        <div class="ranking-list">
            ${sorted.map((item, i) => `
                <div class="ranking-item" onclick="openDetailModal('${item.code}')">
                    <div class="ranking-num ${i === 0 ? 'top1' : i === 1 ? 'top2' : i === 2 ? 'top3' : 'normal'}">${i + 1}</div>
                    <div class="ranking-info">
                        <div class="name">${item.name}</div>
                        <div class="code">${item.code}</div>
                    </div>
                    <div class="ranking-value">
                        <div class="main">${formatNotional(item.notional)}</div>
                        <div class="sub">${item.trades}ç­†</div>
                    </div>
                </div>
            `).join('')}
        </div>
    `;
}

function renderCbasMarketStats() {
    // è¨ˆç®—å„å¹´åº¦çµ±è¨ˆ
    const yearStats = {};
    Object.values(DB.cbas).flat().forEach(r => {
        const year = r.date.substring(0, 4);
        if (!yearStats[year]) yearStats[year] = { notional: 0, trades: 0, premiumSum: 0, count: 0 };
        yearStats[year].notional += r.notional;
        yearStats[year].trades += r.trades;
        yearStats[year].premiumSum += r.premiumAvg * r.trades;
        yearStats[year].count += r.trades;
    });
    
    const years = Object.keys(yearStats).sort().reverse().slice(0, 4);
    
    document.getElementById('cbasMarketStats').innerHTML = years.map(year => {
        const s = yearStats[year];
        const avgPremium = s.count > 0 ? (s.premiumSum / s.count).toFixed(2) : '-';
        return `
            <div class="cbas-stat-card">
                <div class="title"><span>ğŸ“…</span> ${year}å¹´çµ±è¨ˆ</div>
                <div class="main-value">${formatNotional(s.notional)}</div>
                <div class="sub-info">
                    äº¤æ˜“ç­†æ•¸: ${s.trades.toLocaleString()} | 
                    å¹³å‡æ¬Šåˆ©é‡‘: ${avgPremium}å…ƒ
                </div>
            </div>
        `;
    }).join('');
}

// ==================== CBASæ‹†è§£æŸ¥è©¢ ====================
function setCbasFilter(filter) {
    CBAS_FILTER = filter;
    document.querySelectorAll('#cbasQuickFilters .quick-filter').forEach(el => {
        el.classList.toggle('active', el.onclick.toString().includes(`'${filter}'`));
    });
    CBAS_PAGE.current = 1;
    renderCbasTable();
}

function setCbasPeriod(period) {
    CBAS_PERIOD = period;
    document.querySelectorAll('#cbasSection .filter-tab').forEach(el => {
        el.classList.toggle('active', el.onclick.toString().includes(`'${period}'`));
    });
    CBAS_PAGE.current = 1;
    renderCbasTable();
}

function sortCbasTable(field) {
    if (CBAS_SORT.field === field) {
        CBAS_SORT.dir = CBAS_SORT.dir === 'asc' ? 'desc' : 'asc';
    } else {
        CBAS_SORT.field = field;
        CBAS_SORT.dir = 'desc';
    }
    renderCbasTable();
}

function searchCbas() {
    CBAS_PAGE.current = 1;
    renderCbasTable();
}

function getCbasFilteredData() {
    const query = document.getElementById('cbasSearch').value.toLowerCase().trim();
    let records = Object.values(DB.cbas).flat();
    
    // æœŸé–“ç¯©é¸
    if (CBAS_PERIOD !== 'all') {
        records = records.filter(r => r.date.startsWith(CBAS_PERIOD));
    }
    
    // æœå°‹ç¯©é¸
    if (query) {
        records = records.filter(r => 
            r.code.toLowerCase().includes(query) || 
            r.name.toLowerCase().includes(query)
        );
    }
    
    // å¿«é€Ÿç¯©é¸
    switch(CBAS_FILTER) {
        case 'highPremium':
            records = records.filter(r => r.premiumAvg >= 30);
            break;
        case 'highVolume':
            records = records.filter(r => r.notional >= 10000000);
            break;
        case 'frequent':
            records = records.filter(r => r.trades >= 5);
            break;
    }
    
    // æ’åº
    records.sort((a, b) => {
        let valA, valB;
        switch(CBAS_SORT.field) {
            case 'code': valA = a.code; valB = b.code; break;
            case 'name': valA = a.name; valB = b.name; break;
            case 'date': valA = a.dateNum; valB = b.dateNum; break;
            case 'notional': valA = a.notional; valB = b.notional; break;
            case 'trades': valA = a.trades; valB = b.trades; break;
            case 'premiumAvg': valA = a.premiumAvg; valB = b.premiumAvg; break;
            case 'premiumLow': valA = a.premiumLow; valB = b.premiumLow; break;
            case 'premiumHigh': valA = a.premiumHigh; valB = b.premiumHigh; break;
            case 'term': valA = a.term; valB = b.term; break;
            default: valA = a.dateNum; valB = b.dateNum;
        }
        if (typeof valA === 'string') {
            return CBAS_SORT.dir === 'asc' ? valA.localeCompare(valB) : valB.localeCompare(valA);
        }
        return CBAS_SORT.dir === 'asc' ? valA - valB : valB - valA;
    });
    
    return records;
}

function renderCbasTable() {
    const data = getCbasFilteredData();
    
    // æ›´æ–°ç¯©é¸è¨ˆæ•¸
    const allRecords = Object.values(DB.cbas).flat();
    document.getElementById('highPremiumCount').textContent = allRecords.filter(r => r.premiumAvg >= 30).length;
    document.getElementById('highVolumeCount').textContent = allRecords.filter(r => r.notional >= 10000000).length;
    document.getElementById('frequentCount').textContent = allRecords.filter(r => r.trades >= 5).length;
    
    // åˆ†é 
    const totalPages = Math.ceil(data.length / CBAS_PAGE.size) || 1;
    if (CBAS_PAGE.current > totalPages) CBAS_PAGE.current = totalPages;
    const start = (CBAS_PAGE.current - 1) * CBAS_PAGE.size;
    const pageData = data.slice(start, start + CBAS_PAGE.size);
    
    if (data.length === 0) {
        document.getElementById('cbasTableBody').innerHTML = `
            <tr><td colspan="9" style="text-align:center;padding:40px;color:var(--gray)">ç„¡ç¬¦åˆæ¢ä»¶çš„è³‡æ–™</td></tr>
        `;
        document.getElementById('cbasPagination').innerHTML = '';
        return;
    }
    
    document.getElementById('cbasTableBody').innerHTML = pageData.map(r => {
        const premiumClass = r.premiumAvg >= 40 ? 'premium-high' : r.premiumAvg >= 20 ? 'premium-mid' : 'premium-low';
        return `
            <tr class="${premiumClass}" onclick="openDetailModal('${r.code}')">
                <td class="code">${r.code}</td>
                <td>${r.name}</td>
                <td class="hide-mobile">${r.date}</td>
                <td class="text-right mono">${formatNotional(r.notional)}</td>
                <td class="text-right">${r.trades}</td>
                <td class="text-right mono" style="font-weight:600;color:var(--cbas-primary)">${r.premiumAvg.toFixed(2)}</td>
                <td class="text-right mono hide-mobile">${r.premiumLow.toFixed(2)}</td>
                <td class="text-right mono hide-mobile">${r.premiumHigh.toFixed(2)}</td>
                <td class="text-right">${r.term}å¹´</td>
            </tr>
        `;
    }).join('');
    
    document.getElementById('cbasPagination').innerHTML = `
        <button onclick="changeCbasPage(-1)" ${CBAS_PAGE.current <= 1 ? 'disabled' : ''}>â—€ ä¸Šä¸€é </button>
        <span class="page-info">ç¬¬ ${CBAS_PAGE.current} é  / å…± ${totalPages} é  (${data.length}ç­†)</span>
        <button onclick="changeCbasPage(1)" ${CBAS_PAGE.current >= totalPages ? 'disabled' : ''}>ä¸‹ä¸€é  â–¶</button>
    `;
}

function changeCbasPage(delta) {
    CBAS_PAGE.current += delta;
    renderCbasTable();
}

// ==================== CBASæ’è¡Œæ¦œ ====================
function setRankingPeriod(period) {
    RANKING_PERIOD = period;
    document.querySelectorAll('#cbasRankingSection .period-tab').forEach(el => {
        el.classList.toggle('active', el.onclick.toString().includes(`'${period}'`));
    });
    renderCbasRanking();
}

function renderCbasRanking() {
    let records = Object.values(DB.cbas).flat();
    
    if (RANKING_PERIOD !== 'all') {
        records = records.filter(r => r.date.startsWith(RANKING_PERIOD));
    }
    
    // çµ±è¨ˆ
    const totalNotional = records.reduce((sum, r) => sum + r.notional, 0);
    const totalTrades = records.reduce((sum, r) => sum + r.trades, 0);
    const avgPremium = totalTrades > 0 ? 
        records.reduce((sum, r) => sum + r.premiumAvg * r.trades, 0) / totalTrades : 0;
    
    document.getElementById('totalNotional').textContent = formatNotional(totalNotional);
    document.getElementById('totalNotionalInfo').textContent = `å…± ${records.length} ç­†äº¤æ˜“ç´€éŒ„`;
    document.getElementById('totalTrades').textContent = totalTrades.toLocaleString();
    document.getElementById('totalTradesInfo').textContent = `æ¶µè“‹ ${new Set(records.map(r => r.code)).size} æª”CB`;
    document.getElementById('avgPremium').textContent = avgPremium.toFixed(2) + 'å…ƒ';
    document.getElementById('avgPremiumInfo').textContent = `åŠ æ¬Šå¹³å‡`;
    
    // åç›®æœ¬é‡‘æ’è¡Œ
    const notionalByCode = {};
    records.forEach(r => {
        if (!notionalByCode[r.code]) {
            notionalByCode[r.code] = { code: r.code, name: r.name, notional: 0, trades: 0 };
        }
        notionalByCode[r.code].notional += r.notional;
        notionalByCode[r.code].trades += r.trades;
    });
    
    const notionalRanking = Object.values(notionalByCode).sort((a, b) => b.notional - a.notional).slice(0, 15);
    
    document.getElementById('notionalRanking').innerHTML = notionalRanking.map((item, i) => `
        <div class="ranking-item" onclick="openDetailModal('${item.code}')">
            <div class="ranking-num ${i === 0 ? 'top1' : i === 1 ? 'top2' : i === 2 ? 'top3' : 'normal'}">${i + 1}</div>
            <div class="ranking-info">
                <div class="name">${item.name}</div>
                <div class="code">${item.code}</div>
            </div>
            <div class="ranking-value">
                <div class="main">${formatNotional(item.notional)}</div>
                <div class="sub">${item.trades}ç­†äº¤æ˜“</div>
            </div>
        </div>
    `).join('');
    
    // æ¬Šåˆ©é‡‘æ’è¡Œ
    const premiumRanking = [...records].sort((a, b) => b.premiumAvg - a.premiumAvg).slice(0, 15);
    
    document.getElementById('premiumRanking').innerHTML = premiumRanking.map((item, i) => `
        <div class="ranking-item" onclick="openDetailModal('${item.code}')">
            <div class="ranking-num ${i === 0 ? 'top1' : i === 1 ? 'top2' : i === 2 ? 'top3' : 'normal'}">${i + 1}</div>
            <div class="ranking-info">
                <div class="name">${item.name}</div>
                <div class="code">${item.code} | ${item.date}</div>
            </div>
            <div class="ranking-value">
                <div class="main">${item.premiumAvg.toFixed(2)}å…ƒ</div>
                <div class="sub">åç›®æœ¬é‡‘ ${formatNotional(item.notional)}</div>
            </div>
        </div>
    `).join('');
}

// ==================== åƒ¹æ ¼æŸ¥è©¢ ====================
function setPriceFilter(filter) {
    PRICE_FILTER = filter;
    document.querySelectorAll('#priceSection .quick-filter').forEach(el => {
        el.classList.toggle('active', el.onclick.toString().includes(`'${filter}'`));
    });
    PRICE_PAGE.current = 1;
    renderPriceTable();
}

function sortPriceTable(field) {
    if (PRICE_SORT.field === field) {
        PRICE_SORT.dir = PRICE_SORT.dir === 'asc' ? 'desc' : 'asc';
    } else {
        PRICE_SORT.field = field;
        PRICE_SORT.dir = 'desc';
    }
    renderPriceTable();
}

function filterPriceTable() {
    PRICE_PAGE.current = 1;
    renderPriceTable();
}

function getPriceFilteredData() {
    const query = document.getElementById('priceSearch').value.toLowerCase().trim();
    let data = Object.entries(DB.priceLatest).map(([code, p]) => ({
        code,
        name: p.name,
        date: p.date,
        open: p.open,
        high: p.high,
        low: p.low,
        close: p.close,
        change: p.change,
        changePct: p.close > 0 ? ((p.change / (p.close - p.change)) * 100) : 0,
        volume: p.volume,
        hasCbas: !!DB.cbas[code]
    }));
    
    // æœå°‹ç¯©é¸
    if (query) {
        data = data.filter(d => 
            d.code.toLowerCase().includes(query) || 
            d.name.toLowerCase().includes(query)
        );
    }
    
    // å¿«é€Ÿç¯©é¸
    switch(PRICE_FILTER) {
        case 'discount':
            data = data.filter(d => d.close < 100);
            break;
        case 'lowPremium':
            data = data.filter(d => d.close >= 100 && d.close < 110);
            break;
        case 'hasCbas':
            data = data.filter(d => d.hasCbas);
            break;
    }
    
    // æ’åº
    data.sort((a, b) => {
        let valA = a[PRICE_SORT.field];
        let valB = b[PRICE_SORT.field];
        if (typeof valA === 'string') {
            return PRICE_SORT.dir === 'asc' ? valA.localeCompare(valB) : valB.localeCompare(valA);
        }
        return PRICE_SORT.dir === 'asc' ? valA - valB : valB - valA;
    });
    
    return data;
}

function renderPriceTable() {
    const data = getPriceFilteredData();
    const allData = Object.values(DB.priceLatest);
    
    // æ›´æ–°è¨ˆæ•¸
    document.getElementById('priceAllCount').textContent = allData.length;
    document.getElementById('discountCount').textContent = allData.filter(p => p.close < 100).length;
    document.getElementById('lowPremiumCount').textContent = allData.filter(p => p.close >= 100 && p.close < 110).length;
    document.getElementById('hasCbasCount').textContent = allData.filter(p => DB.cbas[Object.keys(DB.priceLatest).find(k => DB.priceLatest[k] === p)]).length;
    
    // æ›´æ–°é¢¨éšªåˆ†å¸ƒçµ±è¨ˆ
    document.getElementById('riskSafeCount').textContent = allData.filter(p => p.close < 110).length;
    document.getElementById('riskCautionCount').textContent = allData.filter(p => p.close >= 110 && p.close < 120).length;
    document.getElementById('riskWarningCount').textContent = allData.filter(p => p.close >= 120 && p.close < 130).length;
    document.getElementById('riskDangerCount').textContent = allData.filter(p => p.close >= 130).length;
    
    // åˆ†é 
    const totalPages = Math.ceil(data.length / PRICE_PAGE.size) || 1;
    if (PRICE_PAGE.current > totalPages) PRICE_PAGE.current = totalPages;
    const start = (PRICE_PAGE.current - 1) * PRICE_PAGE.size;
    const pageData = data.slice(start, start + PRICE_PAGE.size);
    
    if (data.length === 0) {
        document.getElementById('priceTableBody').innerHTML = `
            <tr><td colspan="10" style="text-align:center;padding:40px;color:var(--gray)">ç„¡ç¬¦åˆæ¢ä»¶çš„è³‡æ–™</td></tr>
        `;
        document.getElementById('pricePagination').innerHTML = '';
        return;
    }
    
    document.getElementById('priceTableBody').innerHTML = pageData.map(d => {
        const changeClass = d.change > 0 ? 'up' : d.change < 0 ? 'down' : '';
        const priceClass = d.close < 100 ? 'premium-low' : d.close > 120 ? 'premium-high' : '';
        const riskLevel = getPriceRiskLevel(d.close);
        const riskClass = riskLevel.level === 'safe' ? 'safe' : riskLevel.level === 'caution' ? 'caution' : riskLevel.level === 'warning' ? 'warning' : 'danger';
        return `
            <tr class="${priceClass}" onclick="openDetailModal('${d.code}')" title="${riskLevel.tip}">
                <td class="code">${d.code}</td>
                <td>${d.name}</td>
                <td class="text-right mono" style="font-weight:600">${d.close.toFixed(2)}</td>
                <td class="text-right mono ${changeClass}">${d.change > 0 ? '+' : ''}${d.change.toFixed(2)}</td>
                <td class="text-right mono ${changeClass}">${d.changePct > 0 ? '+' : ''}${d.changePct.toFixed(2)}%</td>
                <td class="text-center">
                    <span class="risk-indicator ${riskClass}" style="font-size:11px;padding:2px 8px;">${riskLevel.label}</span>
                </td>
                <td class="text-right mono hide-mobile">${d.high.toFixed(2)}</td>
                <td class="text-right mono hide-mobile">${d.low.toFixed(2)}</td>
                <td class="text-center">
                    <span class="cbas-badge ${d.hasCbas ? 'has-cbas' : 'no-cbas'}">
                        ${d.hasCbas ? 'ğŸ”„ æœ‰' : 'ï¼'}
                    </span>
                </td>
            </tr>
        `;
    }).join('');
    
    document.getElementById('pricePagination').innerHTML = `
        <button onclick="changePricePage(-1)" ${PRICE_PAGE.current <= 1 ? 'disabled' : ''}>â—€ ä¸Šä¸€é </button>
        <span class="page-info">ç¬¬ ${PRICE_PAGE.current} é  / å…± ${totalPages} é  (${data.length}ç­†)</span>
        <button onclick="changePricePage(1)" ${PRICE_PAGE.current >= totalPages ? 'disabled' : ''}>ä¸‹ä¸€é  â–¶</button>
    `;
}

function changePricePage(delta) {
    PRICE_PAGE.current += delta;
    renderPriceTable();
}

// ==================== çœ‹æ¿è³‡è¨Š ====================
function sortKanbanTable(field) {
    if (KANBAN_SORT.field === field) {
        KANBAN_SORT.dir = KANBAN_SORT.dir === 'asc' ? 'desc' : 'asc';
    } else {
        KANBAN_SORT.field = field;
        KANBAN_SORT.dir = 'desc';
    }
    renderKanbanTable();
}

function filterKanbanTable() {
    KANBAN_PAGE.current = 1;
    renderKanbanTable();
}

function getKanbanFilteredData() {
    const query = document.getElementById('kanbanSearch').value.toLowerCase().trim();
    let data = Object.values(DB.kanbanLatest);
    
    if (query) {
        data = data.filter(d => 
            d.code.toLowerCase().includes(query) || 
            d.name.toLowerCase().includes(query)
        );
    }
    
    data.sort((a, b) => {
        let valA = a[KANBAN_SORT.field];
        let valB = b[KANBAN_SORT.field];
        if (typeof valA === 'string') {
            return KANBAN_SORT.dir === 'asc' ? valA.localeCompare(valB) : valB.localeCompare(valA);
        }
        return KANBAN_SORT.dir === 'asc' ? valA - valB : valB - valA;
    });
    
    return data;
}

function renderKanbanTable() {
    const data = getKanbanFilteredData();
    
    const totalPages = Math.ceil(data.length / KANBAN_PAGE.size) || 1;
    if (KANBAN_PAGE.current > totalPages) KANBAN_PAGE.current = totalPages;
    const start = (KANBAN_PAGE.current - 1) * KANBAN_PAGE.size;
    const pageData = data.slice(start, start + KANBAN_PAGE.size);
    
    if (data.length === 0) {
        document.getElementById('kanbanTableBody').innerHTML = `
            <tr><td colspan="10" style="text-align:center;padding:40px;color:var(--gray)">ç„¡ç¬¦åˆæ¢ä»¶çš„è³‡æ–™</td></tr>
        `;
        document.getElementById('kanbanPagination').innerHTML = '';
        return;
    }
    
    document.getElementById('kanbanTableBody').innerHTML = pageData.map(d => `
        <tr onclick="openDetailModal('${d.code}')">
            <td class="code">${d.code}</td>
            <td>${d.name}</td>
            <td class="text-right mono" style="font-weight:600;color:var(--primary)">${d.convPrice > 0 ? d.convPrice.toFixed(2) : '-'}</td>
            <td class="hide-mobile">${d.convStart || '-'}</td>
            <td class="hide-mobile">${d.convEnd || '-'}</td>
            <td class="hide-mobile">${d.putDate || '-'}</td>
            <td class="text-right mono hide-mobile">${d.putPrice > 0 ? d.putPrice.toFixed(2) : '-'}</td>
            <td class="text-right mono">${d.balance > 0 ? formatNotional(d.balance) : '-'}</td>
            <td class="text-right mono">${d.cbPrice > 0 ? d.cbPrice.toFixed(2) : '-'}</td>
            <td class="text-right mono">${d.stockPrice > 0 ? d.stockPrice.toFixed(2) : '-'}</td>
        </tr>
    `).join('');
    
    document.getElementById('kanbanPagination').innerHTML = `
        <button onclick="changeKanbanPage(-1)" ${KANBAN_PAGE.current <= 1 ? 'disabled' : ''}>â—€ ä¸Šä¸€é </button>
        <span class="page-info">ç¬¬ ${KANBAN_PAGE.current} é  / å…± ${totalPages} é  (${data.length}ç­†)</span>
        <button onclick="changeKanbanPage(1)" ${KANBAN_PAGE.current >= totalPages ? 'disabled' : ''}>ä¸‹ä¸€é  â–¶</button>
    `;
}

function changeKanbanPage(delta) {
    KANBAN_PAGE.current += delta;
    renderKanbanTable();
}

// ==================== å€‹è‚¡æ·±åº¦åˆ†æ ====================
function loadStockAnalysis() {
    const code = document.getElementById('stockCodeInput').value.trim();
    const resultEl = document.getElementById('stockAnalysisResult');
    
    if (!code) {
        resultEl.innerHTML = `
            <div class="empty-state">
                <div class="icon">âš ï¸</div>
                <div class="message">è«‹è¼¸å…¥CBä»£è™Ÿ</div>
            </div>
        `;
        return;
    }
    
    const info = DB.cbInfo[code] || {};
    const cbasRecords = DB.cbas[code] || [];
    const priceRecords = DB.price[code] || [];
    const latestPrice = DB.priceLatest[code];
    const kanban = DB.kanbanLatest[code];
    const isListed = DB.listedCodes.has(code);
    
    if (!info.name && !cbasRecords.length && !priceRecords.length && !kanban) {
        resultEl.innerHTML = `
            <div class="empty-state">
                <div class="icon">âŒ</div>
                <div class="message">æ‰¾ä¸åˆ°ä»£è™Ÿ ${code} çš„è³‡æ–™</div>
            </div>
        `;
        return;
    }
    
    const name = info.name || latestPrice?.name || kanban?.name || code;
    const currentPrice = latestPrice?.close || kanban?.cbPrice || 0;
    
    // CBASçµ±è¨ˆ
    const totalCbasNotional = cbasRecords.reduce((sum, r) => sum + r.notional, 0);
    const totalCbasTrades = cbasRecords.reduce((sum, r) => sum + r.trades, 0);
    const avgPremium = totalCbasTrades > 0 ? 
        cbasRecords.reduce((sum, r) => sum + r.premiumAvg * r.trades, 0) / totalCbasTrades : 0;
    
    // åƒ¹æ ¼é¢¨éšªç­‰ç´š
    const priceRisk = getPriceRiskLevel(currentPrice);
    
    let html = `
        <div style="margin-bottom:20px;">
            <h2 style="font-size:24px;font-weight:800;color:var(--text);display:flex;align-items:center;gap:12px;flex-wrap:wrap;">
                ${name} <span style="font-size:16px;color:var(--gray);font-weight:600">${code}</span>
                <span style="font-size:12px;padding:4px 12px;border-radius:12px;background:${isListed ? 'rgba(22,163,74,0.1)' : 'rgba(148,163,184,0.1)'};color:${isListed ? 'var(--listed)' : 'var(--delisted)'}">${isListed ? 'æ›ç‰Œä¸­' : 'å·²ä¸‹å¸‚'}</span>
                ${currentPrice > 0 ? `<span style="font-size:12px;padding:4px 12px;border-radius:12px;background:${priceRisk.level === 'safe' ? 'rgba(22,163,74,0.1)' : priceRisk.level === 'danger' ? 'rgba(220,38,38,0.1)' : 'rgba(245,158,11,0.1)'};color:${priceRisk.color}">${priceRisk.label}</span>` : ''}
            </h2>
            <div style="color:var(--gray);font-size:14px;margin-top:4px;">
                ${info.industry || '-'} | ${info.guarantee || '-'}
            </div>
        </div>
    `;
    
    // æ™ºæ…§æç¤ºå€
    if (currentPrice > 0) {
        const smartTips = generateSmartTips(code, currentPrice, cbasRecords, kanban);
        if (smartTips) {
            html += `
                <div style="margin-bottom:20px;">
                    <div style="font-weight:700;color:#92400e;margin-bottom:12px;display:flex;align-items:center;gap:8px;">
                        <span>ğŸ§ </span> æ™ºæ…§åˆ†ææç¤º
                    </div>
                    ${smartTips}
                </div>
            `;
        }
    }
    
    // åŸºæœ¬è³‡æ–™å¡ç‰‡
    html += `<div class="detail-grid">`;
    
    if (latestPrice) {
        const changeClass = latestPrice.change >= 0 ? 'up' : 'down';
        html += `
            <div class="detail-card">
                <div class="label">æœ€æ–°æ”¶ç›¤åƒ¹</div>
                <div class="value highlight">${latestPrice.close.toFixed(2)}</div>
            </div>
            <div class="detail-card">
                <div class="label">æ¼²è·Œ</div>
                <div class="value ${changeClass}">
                    ${latestPrice.change >= 0 ? '+' : ''}${latestPrice.change.toFixed(2)}
                </div>
            </div>
        `;
    }
    
    if (kanban) {
        html += `
            <div class="detail-card">
                <div class="label">è½‰æ›åƒ¹æ ¼</div>
                <div class="value highlight">${kanban.convPrice > 0 ? kanban.convPrice.toFixed(2) : '-'}</div>
            </div>
            <div class="detail-card">
                <div class="label">ç™¼è¡Œé¤˜é¡</div>
                <div class="value">${kanban.balance > 0 ? formatNotional(kanban.balance) : '-'}</div>
            </div>
        `;
        
        // é¤˜é¡æ¯”ä¾‹è¨ˆç®—
        if (kanban.issueAmount > 0 && kanban.balance > 0) {
            const balanceRatio = (kanban.balance / kanban.issueAmount) * 100;
            html += `
                <div class="detail-card">
                    <div class="label">é¤˜é¡æ¯”ä¾‹</div>
                    <div class="value" style="color:${balanceRatio < 70 ? 'var(--up)' : balanceRatio < 90 ? 'var(--warning)' : 'var(--text)'}">
                        ${balanceRatio.toFixed(1)}%
                    </div>
                </div>
            `;
        }
    }
    
    html += `</div>`;
    
    // CBASåˆ†æå€
    if (cbasRecords.length > 0) {
        html += `
            <div class="content-section" style="margin-top:20px;background:var(--cbas-bg);border:1px solid var(--cbas-border);">
                <div class="section-title" style="color:var(--cbas-primary);margin-bottom:16px;">
                    <span class="icon">ğŸ”„</span> CBASæ‹†è§£åˆ†æ
                </div>
                <div class="detail-grid">
                    <div class="detail-card" style="background:#fff;">
                        <div class="label">ç´¯è¨ˆæ‹†è§£æ¬¡æ•¸</div>
                        <div class="value cbas">${cbasRecords.length}æ¬¡</div>
                    </div>
                    <div class="detail-card" style="background:#fff;">
                        <div class="label">ç´¯è¨ˆåç›®æœ¬é‡‘</div>
                        <div class="value cbas">${formatNotional(totalCbasNotional)}</div>
                    </div>
                    <div class="detail-card" style="background:#fff;">
                        <div class="label">ç´¯è¨ˆäº¤æ˜“ç­†æ•¸</div>
                        <div class="value cbas">${totalCbasTrades}</div>
                    </div>
                    <div class="detail-card" style="background:#fff;">
                        <div class="label">å¹³å‡æ¬Šåˆ©é‡‘</div>
                        <div class="value cbas">${avgPremium.toFixed(2)}å…ƒ</div>
                    </div>
                </div>
                
                <div style="margin-top:16px;">
                    <div style="font-weight:600;color:var(--cbas-primary);margin-bottom:12px;">ğŸ“‹ æœ€è¿‘CBASäº¤æ˜“ç´€éŒ„</div>
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>æ—¥æœŸ</th>
                                    <th class="text-right">åç›®æœ¬é‡‘</th>
                                    <th class="text-right">ç­†æ•¸</th>
                                    <th class="text-right">æ¬Šåˆ©é‡‘(ä½)</th>
                                    <th class="text-right">æ¬Šåˆ©é‡‘(é«˜)</th>
                                    <th class="text-right">æ¬Šåˆ©é‡‘(å‡)</th>
                                    <th class="text-right">æœŸé–“</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${cbasRecords.slice().sort((a, b) => b.dateNum - a.dateNum).slice(0, 20).map(r => `
                                    <tr>
                                        <td>${r.date}</td>
                                        <td class="text-right mono">${formatNotional(r.notional)}</td>
                                        <td class="text-right">${r.trades}</td>
                                        <td class="text-right mono">${r.premiumLow.toFixed(2)}</td>
                                        <td class="text-right mono">${r.premiumHigh.toFixed(2)}</td>
                                        <td class="text-right mono" style="color:var(--cbas-primary);font-weight:600">${r.premiumAvg.toFixed(2)}</td>
                                        <td class="text-right">${r.term}å¹´</td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                    ${cbasRecords.length > 20 ? `<div style="text-align:center;padding:12px;color:var(--gray);font-size:13px;">åƒ…é¡¯ç¤ºæœ€è¿‘20ç­†</div>` : ''}
                </div>
            </div>
        `;
    } else {
        html += `
            <div class="content-section" style="margin-top:20px;background:#f8fafc;">
                <div class="empty-state" style="padding:30px;">
                    <div class="icon">ğŸ“­</div>
                    <div class="message">æ­¤CBç„¡CBASæ‹†è§£ç´€éŒ„</div>
                </div>
            </div>
        `;
    }
    
    // çœ‹æ¿è³‡è¨Šå€
    if (kanban) {
        html += `
            <div class="content-section" style="margin-top:20px;">
                <div class="section-title" style="margin-bottom:16px;">
                    <span class="icon">ğŸ“‹</span> çœ‹æ¿è©³ç´°è³‡è¨Š
                </div>
                <div class="detail-grid">
                    <div class="detail-card">
                        <div class="label">è½‰æ›èµ·æ—¥</div>
                        <div class="value">${kanban.convStart || '-'}</div>
                    </div>
                    <div class="detail-card">
                        <div class="label">è½‰æ›è¿„æ—¥</div>
                        <div class="value">${kanban.convEnd || '-'}</div>
                    </div>
                    <div class="detail-card">
                        <div class="label">è³£å›æ¬Šæ—¥æœŸ</div>
                        <div class="value">${kanban.putDate || '-'}</div>
                    </div>
                    <div class="detail-card">
                        <div class="label">è³£å›åƒ¹æ ¼</div>
                        <div class="value">${kanban.putPrice > 0 ? kanban.putPrice.toFixed(2) : '-'}</div>
                    </div>
                    <div class="detail-card">
                        <div class="label">å¼·åˆ¶è´–å›èµ·æ—¥</div>
                        <div class="value">${kanban.forceRedeemStart || '-'}</div>
                    </div>
                    <div class="detail-card">
                        <div class="label">åŸå§‹ç™¼è¡Œç¸½é¡</div>
                        <div class="value">${kanban.issueAmount > 0 ? formatNotional(kanban.issueAmount) : '-'}</div>
                    </div>
                    <div class="detail-card">
                        <div class="label">è‚¡ç¥¨åƒ¹æ ¼</div>
                        <div class="value">${kanban.stockPrice > 0 ? kanban.stockPrice.toFixed(2) : '-'}</div>
                    </div>
                    <div class="detail-card">
                        <div class="label">ç¥¨é¢åˆ©ç‡</div>
                        <div class="value">${kanban.couponRate > 0 ? kanban.couponRate + '%' : '-'}</div>
                    </div>
                </div>
            </div>
        `;
    }
    
    resultEl.innerHTML = html;
}

// ==================== è©³ç´°è³‡æ–™å½ˆçª— ====================
function openDetailModal(code) {
    const info = DB.cbInfo[code] || {};
    const cbasRecords = DB.cbas[code] || [];
    const latestPrice = DB.priceLatest[code];
    const kanban = DB.kanbanLatest[code];
    const isListed = DB.listedCodes.has(code);
    const name = info.name || latestPrice?.name || kanban?.name || code;
    
    document.getElementById('modalTitle').innerHTML = `<span>ğŸ“Š</span> ${name} (${code})`;
    
    // CBASçµ±è¨ˆ
    const totalCbasNotional = cbasRecords.reduce((sum, r) => sum + r.notional, 0);
    const totalCbasTrades = cbasRecords.reduce((sum, r) => sum + r.trades, 0);
    const avgPremium = totalCbasTrades > 0 ? 
        cbasRecords.reduce((sum, r) => sum + r.premiumAvg * r.trades, 0) / totalCbasTrades : 0;
    
    let html = `
        <div style="display:flex;align-items:center;gap:12px;margin-bottom:20px;">
            <span style="font-size:14px;padding:6px 14px;border-radius:20px;background:${isListed ? 'rgba(22,163,74,0.1)' : 'rgba(148,163,184,0.1)'};color:${isListed ? 'var(--listed)' : 'var(--delisted)'};font-weight:600">
                ${isListed ? 'ğŸŸ¢ æ›ç‰Œä¸­' : 'âš« å·²ä¸‹å¸‚'}
            </span>
            <span style="font-size:13px;color:var(--gray)">${info.industry || '-'} | ${info.guarantee || '-'}</span>
        </div>
        
        <div class="detail-grid">
            ${latestPrice ? `
                <div class="detail-card">
                    <div class="label">æœ€æ–°æ”¶ç›¤</div>
                    <div class="value highlight">${latestPrice.close.toFixed(2)}</div>
                </div>
                <div class="detail-card">
                    <div class="label">æ¼²è·Œ</div>
                    <div class="value" style="color:${latestPrice.change >= 0 ? 'var(--up)' : 'var(--down)'}">
                        ${latestPrice.change >= 0 ? '+' : ''}${latestPrice.change.toFixed(2)}
                    </div>
                </div>
                <div class="detail-card">
                    <div class="label">æˆäº¤é‡</div>
                    <div class="value">${latestPrice.volume}å¼µ</div>
                </div>
            ` : ''}
            ${kanban ? `
                <div class="detail-card">
                    <div class="label">è½‰æ›åƒ¹</div>
                    <div class="value highlight">${kanban.convPrice > 0 ? kanban.convPrice.toFixed(2) : '-'}</div>
                </div>
                <div class="detail-card">
                    <div class="label">ç™¼è¡Œé¤˜é¡</div>
                    <div class="value">${kanban.balance > 0 ? kanban.balance.toFixed(2) + 'å„„' : '-'}</div>
                </div>
            ` : ''}
        </div>
    `;
    
    // CBASè³‡è¨Š
    if (cbasRecords.length > 0) {
        html += `
            <div style="background:var(--cbas-bg);border-radius:12px;padding:16px;margin-top:20px;border:1px solid var(--cbas-border);">
                <div style="font-weight:700;color:var(--cbas-primary);margin-bottom:12px;display:flex;align-items:center;gap:8px;">
                    <span>ğŸ”„</span> CBASæ‹†è§£çµ±è¨ˆ
                </div>
                <div class="detail-grid" style="grid-template-columns:repeat(4, 1fr);">
                    <div class="detail-card" style="background:#fff;">
                        <div class="label">æ‹†è§£æ¬¡æ•¸</div>
                        <div class="value cbas">${cbasRecords.length}</div>
                    </div>
                    <div class="detail-card" style="background:#fff;">
                        <div class="label">ç´¯è¨ˆæœ¬é‡‘</div>
                        <div class="value cbas">${formatNotional(totalCbasNotional)}</div>
                    </div>
                    <div class="detail-card" style="background:#fff;">
                        <div class="label">ç´¯è¨ˆç­†æ•¸</div>
                        <div class="value cbas">${totalCbasTrades}</div>
                    </div>
                    <div class="detail-card" style="background:#fff;">
                        <div class="label">å¹³å‡æ¬Šåˆ©é‡‘</div>
                        <div class="value cbas">${avgPremium.toFixed(2)}å…ƒ</div>
                    </div>
                </div>
                
                <div style="margin-top:12px;max-height:200px;overflow-y:auto;">
                    <table style="font-size:13px;">
                        <thead>
                            <tr>
                                <th>æ—¥æœŸ</th>
                                <th class="text-right">åç›®æœ¬é‡‘</th>
                                <th class="text-right">ç­†æ•¸</th>
                                <th class="text-right">æ¬Šåˆ©é‡‘(å‡)</th>
                                <th class="text-right">æœŸé–“</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${cbasRecords.slice().sort((a, b) => b.dateNum - a.dateNum).slice(0, 10).map(r => `
                                <tr>
                                    <td>${r.date}</td>
                                    <td class="text-right mono">${formatNotional(r.notional)}</td>
                                    <td class="text-right">${r.trades}</td>
                                    <td class="text-right mono" style="color:var(--cbas-primary)">${r.premiumAvg.toFixed(2)}</td>
                                    <td class="text-right">${r.term}å¹´</td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                </div>
            </div>
        `;
    }
    
    document.getElementById('modalBody').innerHTML = html;
    document.getElementById('detailModal').classList.add('show');
}

function closeModal() {
    document.getElementById('detailModal').classList.remove('show');
}

// ==================== å·¥å…·å‡½æ•¸ ====================
function formatNotional(value) {
    if (value >= 100000000) {
        return (value / 100000000).toFixed(2) + 'å„„';
    } else if (value >= 10000000) {
        return (value / 10000000).toFixed(2) + 'åƒè¬';
    } else if (value >= 10000) {
        return (value / 10000).toFixed(0) + 'è¬';
    }
    return value.toLocaleString();
}

// ==================== æ™ºæ…§åˆ†æç³»çµ± ====================
const RESEARCH_DATA = {
    // åƒ¹ä½é¢¨éšªæ•¸æ“š (ä¾†è‡ªå°ˆé¡Œ1-1)
    priceRisk: {
        90: { lossOver20: 1.5, riskRewardRatio: 32.8, level: 'safe' },
        100: { lossOver20: 1.4, riskRewardRatio: 32.4, level: 'safe' },
        110: { lossOver20: 1.4, riskRewardRatio: 30.6, level: 'safe' },
        120: { lossOver20: 5.4, riskRewardRatio: 8.9, level: 'caution' },
        130: { lossOver20: 25.0, riskRewardRatio: 2.1, level: 'warning' },
        150: { lossOver20: 24.0, riskRewardRatio: 2.2, level: 'warning' },
        180: { lossOver20: 25.1, riskRewardRatio: 1.9, level: 'danger' },
        200: { lossOver20: 23.4, riskRewardRatio: 2.1, level: 'danger' }
    },
    // CBASä¸»åŠ›è¿½è¹¤æ•¸æ“š (ä¾†è‡ªå°ˆé¡Œ1-2-1)
    cbasWarning: {
        safe: { priceRange: '100-115å…ƒ', cbasRatio: '<70%', status: 'ä¸»åŠ›æ­£åœ¨å¸ƒå±€' },
        yellow: { priceRange: '115-125å…ƒ', cbasRatio: '>70%', status: 'å¸ƒå±€æ¥è¿‘å®Œæˆ' },
        orange: { priceRange: '125-135å…ƒ', cbasRatio: '>80%', status: 'é€²å…¥å‡ºå ´å€åŸŸ' },
        red: { priceRange: '135-150å…ƒ', cbasRatio: '>80%+é¤˜é¡æ¸›å°‘', status: 'ä¸»åŠ›æ­£åœ¨å‡ºå ´' },
        danger: { priceRange: '>150å…ƒ', cbasRatio: 'é¤˜é¡æ¸›>20%', status: 'å¯èƒ½å·²å‡ºå ´å¤§åŠ' }
    }
};

// æ ¹æ“šåƒ¹æ ¼ç²å–é¢¨éšªç­‰ç´š
function getPriceRiskLevel(price) {
    if (price < 100) return { level: 'safe', label: 'ç ´åº•å€', color: '#16a34a', tip: 'ç ´åº•è²·å…¥ç²åˆ©ç‡é”82.1%ï¼Œæ˜¯é»ƒé‡‘è²·é»' };
    if (price < 110) return { level: 'safe', label: 'å®‰å…¨å€', color: '#16a34a', tip: 'è™§>20%æ©Ÿç‡åƒ…1.4%ï¼Œå®‰å…¨é‚Šéš›å¼·' };
    if (price < 120) return { level: 'caution', label: 'è½‰æŠ˜å€', color: '#f59e0b', tip: 'è™§>20%æ©Ÿç‡å‡è‡³5.4%ï¼Œé–‹å§‹éœ€è¦æ³¨æ„' };
    if (price < 130) return { level: 'warning', label: 'è­¦æˆ’å€', color: '#f97316', tip: 'æ¥è¿‘130å…ƒé¢¨éšªåˆ†æ°´å¶ºï¼Œå»ºè­°è¨­å®šåœåˆ©' };
    if (price < 150) return { level: 'warning', label: 'é«˜é¢¨éšªå€', color: '#dc2626', tip: '130å…ƒä»¥ä¸Šè™§>20%æ©Ÿç‡é”25%ï¼Œè¢«å¥—æ©Ÿç‡94%' };
    if (price < 180) return { level: 'danger', label: 'æ¥µé«˜é¢¨éšª', color: '#dc2626', tip: 'ä¸»åŠ›å¯èƒ½æ­£åœ¨å‡ºå ´ï¼Œé¿å…è¿½é«˜' };
    return { level: 'danger', label: 'å±éšªå€', color: '#7f1d1d', tip: '200å…ƒä»¥ä¸Šè™§>30%æ©Ÿç‡16%ï¼Œæ¥µåº¦å±éšª' };
}

// æ ¹æ“šCBASæ‹†è§£æ¯”ä¾‹å’Œåƒ¹æ ¼ç²å–ä¸»åŠ›å‹•æ…‹æç¤º
function getCbasWarningLevel(price, cbasRatio, balanceRatio) {
    if (price <= 115 && cbasRatio < 70) {
        return { level: 'safe', label: 'å®‰å…¨å€', tip: 'ä¸»åŠ›æ­£åœ¨å¸ƒå±€ï¼Œå¯æŒçºŒæŒæœ‰' };
    }
    if (price <= 125 && cbasRatio >= 70) {
        return { level: 'yellow', label: 'é»ƒç‡ˆå€', tip: 'ä¸»åŠ›å¸ƒå±€æ¥è¿‘å®Œæˆï¼Œå»ºè­°è¨­å®šåœåˆ©é»' };
    }
    if (price <= 135 && cbasRatio >= 80) {
        return { level: 'orange', label: 'æ©˜ç‡ˆå€', tip: 'é€²å…¥å¥—åˆ©å‡ºå ´å€åŸŸå‰ç·£ï¼Œæº–å‚™åœåˆ©' };
    }
    if (price <= 150 && balanceRatio < 100) {
        return { level: 'red', label: 'ç´…ç‡ˆå€', tip: 'ä¸»åŠ›æ­£åœ¨å¤§é‡å¥—åˆ©å‡ºå ´ï¼Œå»ºè­°åˆ†æ‰¹åœåˆ©' };
    }
    if (price > 150 && balanceRatio < 80) {
        return { level: 'danger', label: 'é«˜å±å€', tip: 'ä¸»åŠ›å¯èƒ½å·²å‡ºå ´å¤§åŠï¼Œé¿å…è¿½é«˜' };
    }
    return { level: 'caution', label: 'è§€å¯Ÿä¸­', tip: 'æŒçºŒé—œæ³¨é¤˜é¡è®ŠåŒ–' };
}

// ç”Ÿæˆæ™ºæ…§æç¤ºHTML
function generateSmartTips(code, price, cbasRecords, kanban) {
    const tips = [];
    
    // åƒ¹æ ¼é¢¨éšªæç¤º
    const priceRisk = getPriceRiskLevel(price);
    tips.push({
        type: priceRisk.level === 'safe' ? 'success' : priceRisk.level === 'danger' ? 'danger' : 'warning',
        icon: priceRisk.level === 'safe' ? 'âœ…' : priceRisk.level === 'danger' ? 'ğŸš¨' : 'âš ï¸',
        title: `åƒ¹æ ¼é¢¨éšªï¼š${priceRisk.label}`,
        desc: priceRisk.tip
    });
    
    // CBASæ‹†è§£æç¤º
    if (cbasRecords && cbasRecords.length > 0) {
        const totalNotional = cbasRecords.reduce((sum, r) => sum + r.notional, 0);
        const recentCbas = cbasRecords.filter(r => r.dateNum >= 20240101);
        
        if (recentCbas.length > 0) {
            const avgPremium = recentCbas.reduce((sum, r) => sum + r.premiumAvg, 0) / recentCbas.length;
            if (avgPremium >= 30) {
                tips.push({
                    type: 'warning',
                    icon: 'ğŸ’°',
                    title: `é«˜æ¬Šåˆ©é‡‘è­¦ç¤ºï¼šå¹³å‡${avgPremium.toFixed(1)}å…ƒ`,
                    desc: 'é«˜æ¬Šåˆ©é‡‘å¯èƒ½åæ˜ å¸‚å ´å°æ­¤CBçœ‹å¥½ï¼Œä½†ä¹Ÿéœ€æ³¨æ„ä¸»åŠ›å¸ƒå±€é€²åº¦'
                });
            }
        }
        
        // ä¼°ç®—CBASæ¯”ä¾‹ (å‡è¨­åŸç™¼è¡Œé¡çš„60-80%æœƒé€²è¡ŒCBAS)
        if (kanban && kanban.issueAmount > 0) {
            const estimatedCbasRatio = (totalNotional / (kanban.issueAmount * 0.7)) * 100;
            if (estimatedCbasRatio > 80 && price > 125) {
                tips.push({
                    type: 'danger',
                    icon: 'ğŸ””',
                    title: 'ä¸»åŠ›å¸ƒå±€å¯èƒ½å·²å®Œæˆ',
                    desc: `CBASæ‹†è§£é‡å·²é”ç›¸ç•¶è¦æ¨¡ï¼Œåƒ¹æ ¼åˆåœ¨125å…ƒä»¥ä¸Šï¼Œå»ºè­°å¯†åˆ‡é—œæ³¨é¤˜é¡è®ŠåŒ–`
                });
            }
        }
    }
    
    // é¤˜é¡è®ŠåŒ–æç¤º
    if (kanban && kanban.issueAmount > 0 && kanban.balance > 0) {
        const balanceRatio = (kanban.balance / kanban.issueAmount) * 100;
        if (balanceRatio < 70 && price > 130) {
            tips.push({
                type: 'danger',
                icon: 'ğŸ“‰',
                title: `é¤˜é¡å·²æ¸›å°‘${(100 - balanceRatio).toFixed(0)}%`,
                desc: 'é¤˜é¡å¤§å¹…æ¸›å°‘ä¸”åƒ¹æ ¼åé«˜ï¼Œä¸»åŠ›å¯èƒ½å·²å‡ºå ´å¤§åŠï¼Œæ³¨æ„è¿½é«˜é¢¨éšª'
            });
        } else if (balanceRatio < 90 && price > 125) {
            tips.push({
                type: 'warning',
                icon: 'ğŸ“Š',
                title: 'é¤˜é¡é–‹å§‹æ¸›å°‘',
                desc: 'æ ¹æ“šçµ±è¨ˆï¼Œé¤˜é¡é¦–æ¬¡é™è‡³90%æ™‚CBåƒ¹æ ¼ä¸­ä½æ•¸ç´„127å…ƒï¼Œä¸»åŠ›é–‹å§‹å‡ºå ´'
            });
        }
    }
    
    // åœåˆ©å»ºè­°
    if (price >= 130 && price <= 145) {
        tips.push({
            type: 'info',
            icon: 'ğŸ’¡',
            title: 'åœåˆ©å€é–“åƒè€ƒ',
            desc: 'æ ¹æ“šçµ±è¨ˆï¼Œä¸»åŠ›å‡ºå ´é›†ä¸­åœ¨127-145å…ƒå€é–“ï¼Œæ­¤åƒ¹ä½å¯è€ƒæ…®åˆ†æ‰¹åœåˆ©'
        });
    }
    
    return tips.map(t => `
        <div class="smart-tip ${t.type === 'info' ? '' : t.type}">
            <div class="icon">${t.icon}</div>
            <div class="content">
                <div class="title">${t.title}</div>
                <div class="desc">${t.desc}</div>
            </div>
        </div>
    `).join('');
}

// ==================== çµ±è¨ˆåˆ†æå ±å‘Š ====================
let RESEARCH_TAB = 'summary';

function setResearchTab(tab) {
    RESEARCH_TAB = tab;
    document.querySelectorAll('.research-tab').forEach(el => {
        el.classList.toggle('active', el.onclick.toString().includes(`'${tab}'`));
    });
    renderResearchContent(tab);
}

function renderResearchContent(tab) {
    const container = document.getElementById('researchContent');
    
    switch(tab) {
        case 'summary':
            container.innerHTML = renderResearchSummary();
            break;
        case 'report1':
            container.innerHTML = renderReport1();
            break;
        case 'report2':
            container.innerHTML = renderReport2();
            break;
        case 'report3':
            container.innerHTML = renderReport3();
            break;
        case 'report4':
            container.innerHTML = renderReport4();
            break;
        case 'report5':
            container.innerHTML = renderReport5();
            break;
        default:
            container.innerHTML = renderResearchSummary();
    }
}

function renderResearchSummary() {
    return `
        <div class="research-content">
            <h2>ğŸ“Š æ™ºæ…§æ‘˜è¦ï¼š15å¹´çµ±è¨ˆæ•¸æ“šçš„æ ¸å¿ƒç™¼ç¾</h2>
            <p style="color:#64748b;margin-bottom:20px;">è³‡æ–™æœŸé–“ï¼š2011-2025å¹´ ï½œ åˆ†ææ¨£æœ¬ï¼š1,608æª”CB ï½œ CBASäº¤æ˜“ç­†æ•¸ï¼š100,344ç­†</p>
            
            <div class="insight-box success">
                <div class="title">ğŸ›¡ï¸ å®‰å…¨é‚Šéš›é—œéµï¼š110å…ƒæ˜¯åˆ†æ°´å¶º</div>
                <ul>
                    <li><strong>110å…ƒä»¥ä¸‹è²·å…¥</strong>ï¼šè™§æ>10%æ©Ÿç‡åƒ…0.6-1.9%ï¼Œè™§æ>20%æ©Ÿç‡åƒ…1.3-1.4%</li>
                    <li><strong>110å…ƒä»¥ä¸Šè²·å…¥</strong>ï¼šè™§æ>10%æ©Ÿç‡è·³å‡è‡³22-41%</li>
                    <li><strong>æœ€ä½³å€é–“100-105å…ƒ</strong>ï¼šè™§>5%åƒ…3.9%ï¼Œè™§>10%åƒ…0.6%</li>
                </ul>
            </div>
            
            <div class="insight-box warning">
                <div class="title">âš ï¸ é¢¨éšªè­¦ç¤ºï¼š130å…ƒæ˜¯å±éšªåˆ†æ°´å¶º</div>
                <ul>
                    <li><strong>130å…ƒè²·å…¥è¢«å¥—æ©Ÿç‡94.1%</strong>ï¼Œåƒ…5.9%è²·å…¥å¾Œä¸€è·¯ä¸Šæ¼²</li>
                    <li><strong>è™§æ>20%æ©Ÿç‡é”25%</strong>ï¼Œç›¸ç•¶æ–¼æ¯4æª”å°±æœ‰1æª”æ·±åº¦è™§æ</li>
                    <li><strong>è§£å¥—æ©Ÿç‡åƒ…ç´„äº”æˆ</strong>ï¼Œ51.6%è¢«å¥—è€…æœ€çµ‚æœªèƒ½è§£å¥—</li>
                    <li><strong>é¢¨éšªå ±é…¬æ¯”å¾30å€é©Ÿé™è‡³2å€</strong></li>
                </ul>
            </div>
            
            <div class="insight-box info">
                <div class="title">ğŸ”„ CBASä¸»åŠ›å‹•æ…‹è¿½è¹¤</div>
                <table class="data-table">
                    <tr><th>è­¦ç¤ºç­‰ç´š</th><th>åƒ¹æ ¼å€é–“</th><th>ä¸»åŠ›ç‹€æ…‹</th><th>å»ºè­°</th></tr>
                    <tr><td><span class="risk-indicator safe">å®‰å…¨å€</span></td><td>100-115å…ƒ</td><td>æ­£åœ¨å¸ƒå±€</td><td>å¯æŒçºŒæŒæœ‰</td></tr>
                    <tr><td><span class="risk-indicator caution">é»ƒç‡ˆå€</span></td><td>115-125å…ƒ</td><td>å¸ƒå±€æ¥è¿‘å®Œæˆ</td><td>è¨­å®šåœåˆ©é»</td></tr>
                    <tr><td><span class="risk-indicator warning">æ©˜ç‡ˆå€</span></td><td>125-135å…ƒ</td><td>é€²å…¥å‡ºå ´å€åŸŸ</td><td>æº–å‚™åœåˆ©</td></tr>
                    <tr><td><span class="risk-indicator warning">ç´…ç‡ˆå€</span></td><td>135-150å…ƒ</td><td>å¤§é‡å‡ºå ´ä¸­</td><td>åˆ†æ‰¹åœåˆ©</td></tr>
                    <tr><td><span class="risk-indicator danger">é«˜å±å€</span></td><td>>150å…ƒ</td><td>å¯èƒ½å·²å‡ºå ´å¤§åŠ</td><td>é¿å…è¿½é«˜</td></tr>
                </table>
            </div>
            
            <div class="insight-box">
                <div class="title">ğŸ’¡ æ ¸å¿ƒç­–ç•¥å»ºè­°</div>
                <ul>
                    <li><strong>è€å¿ƒç­‰å¾…ä½åƒ¹</strong>ï¼š67.3%æ›¾æ¼²åˆ°130çš„CBï¼Œä¹‹å‰éƒ½æœ‰110ä»¥ä¸‹è²·é»</li>
                    <li><strong>ç ´åº•æ˜¯é»ƒé‡‘æ©Ÿæœƒ</strong>ï¼š100å…ƒä»¥ä¸‹è²·å…¥ç²åˆ©ç‡é”82.1%</li>
                    <li><strong>åœåˆ©æ¯”åœæé‡è¦</strong>ï¼šä¸»åŠ›å‡ºå ´é›†ä¸­åœ¨127-145å…ƒå€é–“</li>
                    <li><strong>é¿å…ã€Œåé›»æ¢¯ã€</strong>ï¼šç´„4%é«˜åƒ¹è²·å…¥è€…æ›¾ç²åˆ©50%ä»¥ä¸Šå»æœ€çµ‚è™§æ</li>
                </ul>
            </div>
            
            <h2>ğŸ“ˆ å„åƒ¹ä½é¢¨éšªå ±é…¬é€ŸæŸ¥è¡¨</h2>
            <table class="data-table">
                <tr><th>è²·å…¥åƒ¹ä½</th><th>è™§>20%æ©Ÿç‡</th><th>é¢¨éšªå ±é…¬æ¯”</th><th>é¢¨éšªç­‰ç´š</th></tr>
                <tr><td>90å…ƒ</td><td>1.5%</td><td>32.8</td><td><span class="risk-indicator safe">æ¥µä½</span></td></tr>
                <tr><td>100å…ƒ</td><td>1.4%</td><td>32.4</td><td><span class="risk-indicator safe">æ¥µä½</span></td></tr>
                <tr><td>110å…ƒ</td><td>1.4%</td><td>30.6</td><td><span class="risk-indicator safe">æ¥µä½</span></td></tr>
                <tr class="highlight"><td>120å…ƒ</td><td>5.4%</td><td>8.9</td><td><span class="risk-indicator caution">ä½</span></td></tr>
                <tr class="highlight"><td>130å…ƒ</td><td>25.0%</td><td>2.1</td><td><span class="risk-indicator warning">é«˜</span></td></tr>
                <tr><td>150å…ƒ</td><td>24.0%</td><td>2.2</td><td><span class="risk-indicator warning">é«˜</span></td></tr>
                <tr><td>180å…ƒ</td><td>25.1%</td><td>1.9</td><td><span class="risk-indicator danger">é«˜</span></td></tr>
                <tr><td>200å…ƒ</td><td>23.4%</td><td>2.1</td><td><span class="risk-indicator danger">é«˜</span></td></tr>
            </table>
            
            <div style="background:#f1f5f9;padding:16px;border-radius:8px;margin-top:20px;font-size:13px;color:#64748b;">
                <strong>âš ï¸ æŠ•è³‡é¢¨éšªæé†’</strong><br>
                æœ¬ç³»çµ±æ‰€æœ‰æ•¸æ“šå‡ç‚ºæ­·å²çµ±è¨ˆçµæœï¼Œåƒ…ä¾›åƒè€ƒï¼Œä¸ä»£è¡¨æœªä¾†è¡¨ç¾ã€‚å¯è½‰å‚µæŠ•è³‡æ¶‰åŠå¸‚å ´é¢¨éšªã€ä¿¡ç”¨é¢¨éšªã€æµå‹•æ€§é¢¨éšªç­‰å¤šé‡å› ç´ ï¼ŒæŠ•è³‡äººæ‡‰ä¾æ“šè‡ªèº«é¢¨éšªæ‰¿å—èƒ½åŠ›ï¼Œå¯©æ…è©•ä¼°å¾Œå†åšæŠ•è³‡æ±ºç­–ã€‚æœ¬ç³»çµ±åƒ…ç‚ºè³‡æ–™æ•´ç†èˆ‡çµ±è¨ˆåˆ†æï¼Œä¸æ§‹æˆä»»ä½•æŠ•è³‡å»ºè­°ã€‚
            </div>
        </div>
    `;
}

function renderReport1() {
    return `
        <div class="research-content">
            <h2>å°ˆé¡Œ1-1ï¼šå„åƒ¹ä½è²·å…¥é¢¨éšªå…¨æ™¯çµ±è¨ˆ</h2>
            <p style="color:#64748b;">å¾90å…ƒåˆ°200å…ƒï¼Œé¢¨éšªå ±é…¬æ¯”å·®äº†å¤šå°‘å€ ï½œ è³‡æ–™æœŸé–“ï¼š2011-2025å¹´ ï½œ åˆ†ææ¨£æœ¬ï¼š1,608æª”CB</p>
            
            <h3>ä¸€ã€ç ”ç©¶ç›®æ¨™</h3>
            <p>å»ºç«‹90å…ƒã€100å…ƒã€110å…ƒã€120å…ƒã€130å…ƒã€150å…ƒã€180å…ƒã€200å…ƒå„åƒ¹ä½çš„é¢¨éšªå ±é…¬åŸºæº–æ•¸æ“šï¼Œæä¾›æŠ•è³‡äººå®¢è§€çš„æ±ºç­–åƒè€ƒä¾æ“šã€‚</p>
            
            <h3>äºŒã€æœ€çµ‚å ±é…¬åˆ†å¸ƒçµ±è¨ˆ</h3>
            <table class="data-table">
                <tr><th>åƒ¹ä½</th><th>å¹³å‡å ±é…¬</th><th>ä¸­ä½æ•¸</th><th>æ¨™æº–å·®</th><th>åˆ†å¸ƒç‰¹å¾µ</th></tr>
                <tr><td>90å…ƒ</td><td>24.3%</td><td>-0.9%</td><td>68.9%</td><td>å³å</td></tr>
                <tr><td>100å…ƒ</td><td>24.1%</td><td>-1.0%</td><td>68.9%</td><td>å³å</td></tr>
                <tr><td>110å…ƒ</td><td>23.6%</td><td>-5.0%</td><td>70.3%</td><td>å³å</td></tr>
                <tr><td>120å…ƒ</td><td>22.5%</td><td>-1.9%</td><td>71.3%</td><td>å³å</td></tr>
                <tr><td>130å…ƒ</td><td>22.8%</td><td>1.5%</td><td>71.3%</td><td>å³å</td></tr>
                <tr><td>150å…ƒ</td><td>20.5%</td><td>2.6%</td><td>68.0%</td><td>å³å</td></tr>
            </table>
            <p><em>â€» å ±é…¬åˆ†å¸ƒå‘ˆç¾å³åç‰¹å¾µï¼Œè¡¨ç¤ºå°‘æ•¸æ¥µç«¯ç²åˆ©æ¡ˆä¾‹æ‹‰é«˜å¹³å‡å€¼ï¼Œä¸­ä½æ•¸æ›´èƒ½åæ˜ ä¸€èˆ¬æƒ…æ³</em></p>
            
            <h3>ä¸‰ã€è™§ææ©Ÿç‡çµ±è¨ˆ</h3>
            <table class="data-table">
                <tr><th>åƒ¹ä½</th><th>è™§æ<0%</th><th>è™§>5%</th><th>è™§>10%</th><th>è™§>20%</th><th>è™§>30%</th><th>é¢¨éšªç­‰ç´š</th></tr>
                <tr><td>90å…ƒ</td><td>52.1%</td><td>33.1%</td><td>12.4%</td><td class="highlight">1.5%</td><td>0.5%</td><td><span class="risk-indicator safe">æ¥µä½</span></td></tr>
                <tr><td>100å…ƒ</td><td>54.9%</td><td>33.2%</td><td>12.4%</td><td class="highlight">1.4%</td><td>0.4%</td><td><span class="risk-indicator safe">æ¥µä½</span></td></tr>
                <tr><td>110å…ƒ</td><td>56.0%</td><td>49.9%</td><td>24.4%</td><td class="highlight">1.4%</td><td>0.3%</td><td><span class="risk-indicator safe">æ¥µä½</span></td></tr>
                <tr><td>120å…ƒ</td><td>51.9%</td><td>46.7%</td><td>42.0%</td><td class="highlight">5.4%</td><td>0.5%</td><td><span class="risk-indicator caution">ä½</span></td></tr>
                <tr><td>130å…ƒ</td><td>48.6%</td><td>42.6%</td><td>37.6%</td><td class="highlight">25.0%</td><td>0.9%</td><td><span class="risk-indicator warning">é«˜</span></td></tr>
                <tr><td>150å…ƒ</td><td>45.5%</td><td>41.1%</td><td>34.9%</td><td class="highlight">24.0%</td><td>15.4%</td><td><span class="risk-indicator warning">é«˜</span></td></tr>
            </table>
            
            <div class="insight-box warning">
                <div class="title">ğŸ”‘ é—œéµç™¼ç¾</div>
                <ul>
                    <li><strong>90-110å…ƒå€é–“</strong>ï¼šè™§>20%æ©Ÿç‡ç¶­æŒåœ¨1.4-1.5%ä½æ°´ä½ï¼Œé¢¨éšªå ±é…¬æ¯”é”30å€ä»¥ä¸Š</li>
                    <li><strong>120å…ƒè½‰æŠ˜é»</strong>ï¼šè™§>20%æ©Ÿç‡å‡è‡³5.4%ï¼Œé¢¨éšªå ±é…¬æ¯”å¾30å€é™è‡³8.9å€</li>
                    <li><strong>130å…ƒé¢¨éšªè·³å‡</strong>ï¼šè™§>20%æ©Ÿç‡é”25%ï¼Œé¢¨éšªå ±é…¬æ¯”é™è‡³2.1å€</li>
                    <li><strong>150å…ƒä»¥ä¸Š</strong>ï¼šè™§>30%æ©Ÿç‡æ˜é¡¯ä¸Šå‡ï¼ˆ15-17%ï¼‰</li>
                </ul>
            </div>
        </div>
    `;
}

function renderReport2() {
    return `
        <div class="research-content">
            <h2>å°ˆé¡Œ1-2ï¼š130å…ƒè‡¨ç•Œé»æ·±åº¦å‰–æ</h2>
            <p style="color:#64748b;">ç‚ºä»€éº¼é€™å€‹åƒ¹ä½æ˜¯é¢¨éšªåˆ†æ°´å¶º ï½œ è³‡æ–™æœŸé–“ï¼š2011-2025å¹´ ï½œ åˆ†ææ¨£æœ¬ï¼š760æª”ï¼ˆé¦–æ¬¡çªç ´130å…ƒï¼‰</p>
            
            <h3>ä¸€ã€130å…ƒè²·å…¥çš„è™§ææ·±åº¦åˆ†å¸ƒ</h3>
            <p>130å…ƒè²·å…¥å…±760æª”ï¼Œå…¶ä¸­369æª”æœ€çµ‚è™§æï¼ˆä½”48.6%ï¼‰ã€‚</p>
            <table class="data-table">
                <tr><th>è™§æå€é–“</th><th>æª”æ•¸</th><th>ä½”å…¨éƒ¨æ¯”ä¾‹</th><th>ä½”è™§æè€…æ¯”ä¾‹</th></tr>
                <tr><td>è™§æ0-5%</td><td>45</td><td>5.9%</td><td>12.2%</td></tr>
                <tr><td>è™§æ5-10%</td><td>38</td><td>5.0%</td><td>10.3%</td></tr>
                <tr><td>è™§æ10-15%</td><td>40</td><td>5.3%</td><td>10.8%</td></tr>
                <tr><td>è™§æ15-20%</td><td>56</td><td>7.4%</td><td>15.2%</td></tr>
                <tr class="highlight"><td>è™§æ20-25%</td><td>135</td><td>17.8%</td><td>36.6%</td></tr>
                <tr><td>è™§æ25-30%</td><td>48</td><td>6.3%</td><td>13.0%</td></tr>
                <tr><td>è™§æ>30%</td><td>7</td><td>0.9%</td><td>1.9%</td></tr>
            </table>
            
            <div class="insight-box warning">
                <div class="title">âš ï¸ è™§æé›†ä¸­åœ¨20-25%å€é–“</div>
                <p>åœ¨æ‰€æœ‰è™§ææ¡ˆä¾‹ä¸­ï¼Œæœ‰36.6%çš„è™§æå¹…åº¦è½åœ¨20-25%å€é–“ï¼Œé€™åæ˜ CBåƒ¹æ ¼çš„ã€Œæ”¶æ–‚ã€ç‰¹æ€§â”€â”€ç”±æ–¼æœ‰åˆ°æœŸé‚„æœ¬çš„ä¿è­·ï¼Œæ·±åº¦è™§æï¼ˆè¶…é30%ï¼‰çš„æ©Ÿç‡ç›¸å°æœ‰é™ï¼ˆåƒ…1.9%ï¼‰ã€‚</p>
            </div>
            
            <h3>äºŒã€130å…ƒè²·å…¥éœ€è¦å¤šä¹…æ‰èƒ½è§£å¥—</h3>
            <table class="data-table">
                <tr><th>æƒ…æ³</th><th>æª”æ•¸</th><th>æ¯”ä¾‹</th></tr>
                <tr class="highlight"><td>æ›¾ç¶“è·Œç ´è²·å…¥åƒ¹ï¼ˆè¢«å¥—ï¼‰</td><td>715</td><td>94.1%</td></tr>
                <tr><td>å¾æœªè·Œç ´è²·å…¥åƒ¹</td><td>45</td><td>5.9%</td></tr>
            </table>
            <p><strong>é—œéµç™¼ç¾ï¼š</strong>130å…ƒè²·å…¥å¾Œï¼Œé«˜é”94.1%çš„æ¡ˆä¾‹æ›¾ç¶“æ­·è¢«å¥—çš„æƒ…æ³ã€‚</p>
            
            <table class="data-table">
                <tr><th>è§£å¥—å¤©æ•¸å€é–“</th><th>æª”æ•¸</th><th>ä½”è¢«å¥—è€…æ¯”ä¾‹</th><th>ç´¯ç©æ¯”ä¾‹</th></tr>
                <tr><td>1-5å¤©</td><td>120</td><td>16.8%</td><td>16.8%</td></tr>
                <tr><td>6-10å¤©</td><td>59</td><td>8.3%</td><td>25.0%</td></tr>
                <tr><td>11-20å¤©</td><td>60</td><td>8.4%</td><td>33.4%</td></tr>
                <tr><td>21-60å¤©</td><td>59</td><td>8.3%</td><td>41.7%</td></tr>
                <tr><td>è¶…é60å¤©</td><td>48</td><td>6.7%</td><td>48.4%</td></tr>
                <tr class="highlight"><td>æœªè§£å¥—</td><td>369</td><td>51.6%</td><td>100%</td></tr>
            </table>
            
            <h3>ä¸‰ã€åœæç­–ç•¥æ•ˆæœæ¯”è¼ƒ</h3>
            <table class="data-table">
                <tr><th>ç­–ç•¥</th><th>å¹³å‡å ±é…¬</th><th>ç²åˆ©ç‡</th><th>è™§>20%</th><th>éŒ¯æ®ºç‡</th></tr>
                <tr><td>ä¸åœæ</td><td>22.8%</td><td>51.3%</td><td>25.0%</td><td>-</td></tr>
                <tr><td>åœæ5%</td><td>8.3%</td><td>18.6%</td><td>0.4%</td><td>40.7%</td></tr>
                <tr><td>åœæ10%</td><td>11.2%</td><td>28.0%</td><td>1.1%</td><td>34.0%</td></tr>
                <tr class="highlight"><td>åœæ15%</td><td>14.4%</td><td>35.8%</td><td>4.3%</td><td>27.8%</td></tr>
                <tr><td>åœæ20%</td><td>18.7%</td><td>43.7%</td><td>39.9%</td><td>18.8%</td></tr>
            </table>
            
            <div class="insight-box">
                <div class="title">ğŸ’¡ åœæ15%ç›¸å°å¹³è¡¡</div>
                <p>éŒ¯æ®ºç‡27.8%ï¼Œè™§>20%æ©Ÿç‡é™è‡³4.3%ï¼Œä¿è­·æ•ˆæœæ˜é¡¯ï¼ˆ225æª”å…æ–¼æ›´å¤§è™§æï¼‰ï¼Œå¹³å‡å°‘è™§6.6%ã€‚é€™å¯èƒ½æ˜¯ä¸€å€‹å€¼å¾—åƒè€ƒçš„åœæé»è¨­å®šã€‚</p>
            </div>
        </div>
    `;
}

function renderReport3() {
    return `
        <div class="research-content">
            <h2>å°ˆé¡Œ1-3ï¼šé«˜åƒ¹å€é–“ï¼ˆ150å…ƒä»¥ä¸Šï¼‰é¢¨éšªç‰¹æ€§åˆ†æ</h2>
            <p style="color:#64748b;">å«è©³ç´°å€‹è‚¡æ¡ˆä¾‹ ï½œ è³‡æ–™æœŸé–“ï¼š2011-2025å¹´</p>
            
            <h3>ä¸€ã€å„é«˜åƒ¹ä½é¢¨éšªçµ±è¨ˆç¸½è¦½</h3>
            <table class="data-table">
                <tr><th>åƒ¹ä½</th><th>æ¨£æœ¬</th><th>ç²åˆ©>0%</th><th>è™§>20%</th><th>è™§>30%</th><th>é¢¨éšªå ±é…¬æ¯”</th></tr>
                <tr><td>150å…ƒ</td><td>501</td><td>53.3%</td><td>24.0%</td><td>15.4%</td><td>2.1</td></tr>
                <tr><td>180å…ƒ</td><td>259</td><td>47.9%</td><td>25.1%</td><td>17.0%</td><td>2.1</td></tr>
                <tr><td>200å…ƒ</td><td>171</td><td>50.3%</td><td>23.4%</td><td>16.4%</td><td>2.4</td></tr>
                <tr class="highlight"><td>250å…ƒ</td><td>83</td><td>45.8%</td><td>30.1%</td><td>18.1%</td><td>1.7</td></tr>
                <tr><td>300å…ƒ</td><td>35</td><td>48.6%</td><td>25.7%</td><td>17.1%</td><td>1.9</td></tr>
            </table>
            
            <div class="insight-box warning">
                <div class="title">ğŸ”‘ æ ¸å¿ƒç™¼ç¾</div>
                <ul>
                    <li><strong>150-200å…ƒé¢¨éšªçµæ§‹ç›¸ä¼¼</strong>ï¼šè™§>20%æ©Ÿç‡ç©©å®šåœ¨23-25%ï¼Œé¢¨éšªå ±é…¬æ¯”ç´„2.1-2.4</li>
                    <li><strong>250å…ƒæ˜¯å¦ä¸€é¢¨éšªè‡¨ç•Œé»</strong>ï¼šè™§>20%æ©Ÿç‡è·³å‡è‡³30%ï¼Œé¢¨éšªå ±é…¬æ¯”é™è‡³1.7</li>
                    <li><strong>åé›»æ¢¯ç¾è±¡åš´é‡</strong>ï¼šç´„4%çš„200å…ƒä»¥ä¸Šè²·å…¥æ¡ˆä¾‹æ›¾ç²åˆ©50%ä»¥ä¸Šå»æœ€çµ‚è™§æ</li>
                </ul>
            </div>
            
            <h3>äºŒã€åé›»æ¢¯æ…˜æ¡ˆï¼ˆæ›¾ç²åˆ©â‰¥50%ä½†æœ€çµ‚è™§æï¼‰</h3>
            <p>é€™äº›æ¡ˆä¾‹æ›¾ç¶“å¤§è³ºä½†æœªåŠæ™‚ç²åˆ©äº†çµï¼Œæœ€çµ‚ç”±ç›ˆè½‰è™§ï¼š</p>
            <table class="data-table">
                <tr><th>CBåç¨±</th><th>è²·å…¥åƒ¹</th><th>æ›¾æœ€é«˜ç²åˆ©</th><th>æœ€çµ‚å ±é…¬</th><th>è½å·®</th></tr>
                <tr><td>æ³¢è‹¥å¨ä¸€</td><td>203å…ƒ</td><td>+98.0%</td><td>-42.4%</td><td class="highlight">140.4%</td></tr>
                <tr><td>éˆºç·¯ä¸€</td><td>203å…ƒ</td><td>+75.4%</td><td>-32.5%</td><td>107.9%</td></tr>
                <tr><td>æ¼¢ç£Šä¸€</td><td>212å…ƒ</td><td>+86.8%</td><td>-9.9%</td><td>96.7%</td></tr>
                <tr><td>ä½°ç ”äºŒ</td><td>200å…ƒ</td><td>+86.5%</td><td>-9.5%</td><td>96.0%</td></tr>
            </table>
            <p><em>â€» æ³¢è‹¥å¨ä¸€æœ€ç‚ºå…¸å‹ï¼šæ›¾ç²åˆ©98%å»æœ€çµ‚è™§æ42%ï¼Œè½å·®é«˜é”140%</em></p>
            
            <h3>ä¸‰ã€ç”¢æ¥­åˆ¥ç¸¾æ•ˆåˆ†æï¼ˆ200å…ƒä»¥ä¸Šè²·å…¥ï¼‰</h3>
            <table class="data-table">
                <tr><th>ç”¢æ¥­</th><th>æ¨£æœ¬</th><th>ç²åˆ©ç‡</th><th>è™§>20%</th><th>é¢¨éšªè©•ä¼°</th></tr>
                <tr><td>åŒ–å·¥</td><td>4</td><td>75.0%</td><td>0.0%</td><td><span class="risk-indicator safe">æœ€ä½³</span></td></tr>
                <tr><td>èˆªé‹æ¥­</td><td>6</td><td>83.3%</td><td>0.0%</td><td><span class="risk-indicator safe">ä½³</span></td></tr>
                <tr><td>é›»è…¦åŠé€±é‚Š</td><td>11</td><td>81.8%</td><td>0.0%</td><td><span class="risk-indicator safe">ä½³</span></td></tr>
                <tr><td>åŠå°é«”</td><td>17</td><td>35.3%</td><td>41.2%</td><td><span class="risk-indicator warning">é«˜é¢¨éšª</span></td></tr>
                <tr><td>é›»å­é›¶çµ„ä»¶</td><td>27</td><td>29.6%</td><td>29.6%</td><td><span class="risk-indicator warning">é«˜é¢¨éšª</span></td></tr>
                <tr><td>è§€å…‰é¤æ—…</td><td>3</td><td>0.0%</td><td>100%</td><td><span class="risk-indicator danger">æ¥µå±éšª</span></td></tr>
            </table>
        </div>
    `;
}

function renderReport4() {
    return `
        <div class="research-content">
            <h2>å°ˆé¡Œ1-4ï¼šä½åƒ¹å€é–“å®‰å…¨é‚Šéš›åˆ†æ</h2>
            <p style="color:#64748b;">è³‡æ–™æœŸé–“ï¼š2011-2025å¹´ï¼ˆ15å¹´ï¼‰ï½œ åˆ†ææ¨£æœ¬ï¼š1,608æª”CBå®Œæ•´åƒ¹æ ¼è»Œè·¡</p>
            
            <div class="insight-box success">
                <div class="title">ğŸ“Œ æ ¸å¿ƒç™¼ç¾</div>
                <ul>
                    <li><strong>110å…ƒæ˜¯å®‰å…¨é‚Šéš›çš„é—œéµé–€æª»</strong>ï¼š110å…ƒä»¥ä¸‹è²·å…¥è™§>10%åƒ…0.6-1.9%ï¼Œ110å…ƒä»¥ä¸Šå‰‡è·³å‡è‡³22-41%</li>
                    <li><strong>100-105å…ƒæ˜¯æœ€ä½³å®‰å…¨é‚Šéš›å€é–“</strong>ï¼šè™§>5%åƒ…3.9%ï¼Œè™§>10%åƒ…0.6%</li>
                    <li><strong>ç ´åº•è²·å…¥ç²åˆ©ç‡é”82.1%</strong>ï¼Œæ©Ÿæœƒç¨€ç¼ºä½†åƒ¹å€¼æ¥µé«˜</li>
                    <li><strong>67.3%æ›¾æ¼²åˆ°130çš„CB</strong>ï¼Œä¹‹å‰éƒ½æœ‰110ä»¥ä¸‹è²·é»ï¼Œè€å¿ƒç­‰å¾…æœ‰åƒ¹å€¼</li>
                </ul>
            </div>
            
            <h3>ä¸€ã€ä½åƒ¹å€é–“å®‰å…¨é‚Šéš›æ•ˆæœ</h3>
            <table class="data-table">
                <tr><th>åƒ¹æ ¼å€é–“</th><th>æ¨£æœ¬æ•¸</th><th>ç²åˆ©>0%</th><th>è™§>5%</th><th>è™§>10%</th><th>å¹³å‡æœ€å¤§ç²åˆ©</th></tr>
                <tr class="highlight"><td>100-105å…ƒ</td><td>1,071</td><td>44.2%</td><td>3.9%</td><td>0.6%</td><td>37.7%</td></tr>
                <tr><td>105-110å…ƒ</td><td>1,222</td><td>42.0%</td><td>39.7%</td><td>1.9%</td><td>46.7%</td></tr>
                <tr><td>110-115å…ƒ</td><td>1,207</td><td>44.3%</td><td>49.5%</td><td>22.0%</td><td>50.8%</td></tr>
                <tr><td>115-120å…ƒ</td><td>1,077</td><td>45.3%</td><td>48.9%</td><td>41.2%</td><td>49.1%</td></tr>
            </table>
            
            <h3>äºŒã€ç ´åº•ï¼ˆ100å…ƒä»¥ä¸‹ï¼‰è²·å…¥æ©Ÿæœƒåˆ†æ</h3>
            <table class="data-table">
                <tr><th>ç ´åº•åƒ¹ä½</th><th>æ¨£æœ¬æ•¸</th><th>ç²åˆ©>0%</th><th>å¹³å‡æœ€å¤§ç²åˆ©</th><th>å¹³å‡æœ€çµ‚å ±é…¬</th></tr>
                <tr class="highlight"><td>æ•´é«”ç ´åº•</td><td>559</td><td>82.1%</td><td>30.1%</td><td>16.1%</td></tr>
                <tr><td>95-100å…ƒ</td><td>540</td><td>81.5%</td><td>30.1%</td><td>16.0%</td></tr>
                <tr><td>90-95å…ƒ</td><td>18</td><td>100.0%</td><td>32.4%</td><td>19.7%</td></tr>
            </table>
            
            <div class="insight-box">
                <div class="title">ğŸ’¡ ç ´åº•è²·å…¥å„ªå‹¢</div>
                <ul>
                    <li>ç ´åº•è²·å…¥ç²åˆ©ç‡é«˜é”82.1%ï¼Œé é«˜æ–¼å…¶ä»–åƒ¹ä½çš„45%å·¦å³</li>
                    <li>90-95å…ƒè²·å…¥ç²åˆ©ç‡100%ï¼Œä½†æ¨£æœ¬è¼ƒå°‘ï¼ˆ18æª”ï¼‰éœ€è¬¹æ…è§£è®€</li>
                    <li>ç ´åº•æ©Ÿæœƒç¨€ç¼ºï¼ˆåƒ…559æª”ï¼Œä½”æ¯”ç´„35%ï¼‰ä½†åƒ¹å€¼æ¥µé«˜ï¼Œå€¼å¾—è€å¿ƒç­‰å¾…</li>
                </ul>
            </div>
            
            <h3>ä¸‰ã€ç­‰å¾…ä½åƒ¹çš„åƒ¹å€¼åˆ†æ</h3>
            <table class="data-table">
                <tr><th>çµ±è¨ˆé …ç›®</th><th>æ•¸æ“š</th><th>èªªæ˜</th></tr>
                <tr><td>æ›¾æ¼²åˆ°130å…ƒä»¥ä¸Š</td><td>838æª”</td><td>æ¨£æœ¬æ¯é«”</td></tr>
                <tr class="highlight"><td>æ¼²åˆ°130å‰æ›¾æœ‰110ä»¥ä¸‹è²·é»</td><td>564æª”</td><td>67.3%æœ‰ä½åƒ¹æ©Ÿæœƒ</td></tr>
                <tr><td>ç­‰å¾…ä½åƒ¹çš„æˆåŠŸç‡</td><td>67.3%</td><td>è€å¿ƒç­‰å¾…æœ‰åƒ¹å€¼</td></tr>
            </table>
        </div>
    `;
}

function renderReport5() {
    return `
        <div class="research-content">
            <h2>å°ˆé¡Œ1-2-1ï¼šCBASæ‹†è§£èˆ‡ä¸»åŠ›å‡ºå ´é è­¦æŒ‡æ¨™</h2>
            <p style="color:#64748b;">å¾å¸ƒå±€åˆ°å‡ºå ´ï¼Œä¸»åŠ›å¥—åˆ©è»Œè·¡çš„æ•¸æ“šè¿½è¹¤ ï½œ è³‡æ–™æœŸé–“ï¼š2021-2024å¹´ ï½œ åˆ†ææ¨£æœ¬ï¼š597æª”CB ï½œ CBASäº¤æ˜“ç­†æ•¸ï¼š100,344ç­†</p>
            
            <h3>ä¸€ã€CBASæ‹†è§£æ™‚é»åˆ†æ</h3>
            <p>åˆ†æCBASç´¯è¨ˆæ‹†è§£é”80%æ™‚çš„CBç‹€æ…‹ï¼š</p>
            <table class="data-table">
                <tr><th>çµ±è¨ˆé …ç›®</th><th>CBåƒ¹æ ¼</th><th>é¤˜é¡æ¯”ä¾‹</th><th>è§£è®€</th></tr>
                <tr><td>å¹³å‡å€¼</td><td>121.0å…ƒ</td><td>88.3%</td><td>å¸ƒå±€ä¸­å¾Œæ®µ</td></tr>
                <tr class="highlight"><td>ä¸­ä½æ•¸</td><td>114.8å…ƒ</td><td>100.0%</td><td>é¤˜é¡å°šæœªæ¸›å°‘</td></tr>
                <tr><td>ç¬¬25ç™¾åˆ†ä½</td><td>106.0å…ƒ</td><td>-</td><td>å¸ƒå±€åˆæœŸ</td></tr>
                <tr><td>ç¬¬75ç™¾åˆ†ä½</td><td>125.0å…ƒ</td><td>-</td><td>å¸ƒå±€æœ«æœŸ</td></tr>
            </table>
            <p><em>â€» ä¸»åŠ›åœ¨CBåƒ¹æ ¼105-125å…ƒå€é–“å®Œæˆå¤§éƒ¨åˆ†CBASå¸ƒå±€ï¼Œæ­¤æ™‚é¤˜é¡å¹¾ä¹æ²’æœ‰æ¸›å°‘</em></p>
            
            <h3>äºŒã€é¤˜é¡æ¸›å°‘å„éšæ®µçš„CBåƒ¹æ ¼</h3>
            <table class="data-table">
                <tr><th>é¤˜é¡éšæ®µ</th><th>å¹³å‡åƒ¹æ ¼</th><th>ä¸­ä½æ•¸åƒ¹æ ¼</th><th>ä¸­ä½æ•¸å¤©æ•¸</th><th>å¥—åˆ©é€²åº¦</th></tr>
                <tr><td>é™åˆ°90%ä»¥ä¸‹</td><td>135.7å…ƒ</td><td>127.0å…ƒ</td><td>25å¤©</td><td>é–‹å§‹å‡ºå ´</td></tr>
                <tr><td>é™åˆ°80%ä»¥ä¸‹</td><td>141.4å…ƒ</td><td>130.0å…ƒ</td><td>41å¤©</td><td>åŠ é€Ÿå‡ºå ´</td></tr>
                <tr><td>é™åˆ°70%ä»¥ä¸‹</td><td>148.8å…ƒ</td><td>133.8å…ƒ</td><td>58å¤©</td><td>å¤§é‡å‡ºå ´</td></tr>
                <tr class="highlight"><td>é™åˆ°50%ä»¥ä¸‹</td><td>161.3å…ƒ</td><td>141.5å…ƒ</td><td>104å¤©</td><td>å‡ºå ´å¤§åŠ</td></tr>
            </table>
            <p><em>â€» ä¸»åŠ›å¥—åˆ©å‡ºå ´é›†ä¸­åœ¨CBåƒ¹æ ¼127-145å…ƒå€é–“ï¼Œå¾å¸ƒå±€å®Œæˆåˆ°å¤§é‡å‡ºå ´ç´„1-3å€‹æœˆ</em></p>
            
            <h3>ä¸‰ã€äº”ç´šé è­¦å€é–“</h3>
            <table class="data-table">
                <tr><th>è­¦ç¤ºç­‰ç´š</th><th>è§¸ç™¼æ¢ä»¶</th><th>ä¸»åŠ›ç‹€æ…‹</th><th>å»ºè­°</th></tr>
                <tr><td><span class="risk-indicator safe">å®‰å…¨å€</span></td><td>CBåƒ¹æ ¼100-115å…ƒ</td><td>CBASæ‹†è§£æ´»èºï¼Œæ­£åœ¨å¸ƒå±€</td><td>å¯æŒçºŒæŒæœ‰</td></tr>
                <tr><td><span class="risk-indicator caution">é»ƒç‡ˆå€</span></td><td>åƒ¹æ ¼115-125å…ƒ + CBAS>70%</td><td>å¸ƒå±€æ¥è¿‘å®Œæˆ</td><td>è¨­å®šåœåˆ©é»</td></tr>
                <tr><td><span class="risk-indicator warning">æ©˜ç‡ˆå€</span></td><td>åƒ¹æ ¼125-135å…ƒ + CBAS>80%</td><td>é€²å…¥å‡ºå ´å€åŸŸå‰ç·£</td><td>æº–å‚™åœåˆ©</td></tr>
                <tr><td><span class="risk-indicator warning">ç´…ç‡ˆå€</span></td><td>åƒ¹æ ¼135-150å…ƒ + é¤˜é¡æ¸›å°‘</td><td>æ­£åœ¨å¤§é‡å¥—åˆ©å‡ºå ´</td><td>åˆ†æ‰¹åœåˆ©</td></tr>
                <tr><td><span class="risk-indicator danger">é«˜å±å€</span></td><td>åƒ¹æ ¼>150å…ƒ + é¤˜é¡æ¸›>20%</td><td>å¯èƒ½å·²å‡ºå ´å¤§åŠ</td><td>é¿å…è¿½é«˜</td></tr>
            </table>
            
            <h3>å››ã€é—œéµè¨Šè™Ÿè­˜åˆ¥</h3>
            <div class="insight-box info">
                <div class="title">ğŸ”” å€¼å¾—é—œæ³¨çš„è¨Šè™Ÿ</div>
                <ul>
                    <li><strong>è¨Šè™Ÿ1</strong>ï¼šCBASé¦–æ—¥æ‹†è§£é‡è¶…é2,000å¼µ â†’ å¸‚å ´çœ‹å¥½æ­¤æª”CB</li>
                    <li><strong>è¨Šè™Ÿ2</strong>ï¼šCBASç´¯è¨ˆæ‹†è§£é”80% + CBåƒ¹æ ¼ä»åœ¨115å…ƒä»¥ä¸‹ â†’ é‚„æœ‰ä¸Šæ¼²ç©ºé–“</li>
                    <li><strong>è¨Šè™Ÿ3</strong>ï¼šCBASç´¯è¨ˆæ‹†è§£é”80% + CBåƒ¹æ ¼å·²è¶…é125å…ƒ â†’ é–‹å§‹è­¦æˆ’</li>
                    <li><strong>è¨Šè™Ÿ4</strong>ï¼šé¤˜é¡é¦–æ¬¡æ¸›å°‘ + CBåƒ¹æ ¼åœ¨130å…ƒä»¥ä¸Š â†’ ä¸»åŠ›é–‹å§‹å‡ºå ´</li>
                    <li><strong>è¨Šè™Ÿ5</strong>ï¼šé¤˜é¡é€£çºŒæ¸›å°‘ + CBåƒ¹æ ¼åœ¨140å…ƒä»¥ä¸Š â†’ åŠ é€Ÿå‡ºå ´ä¸­</li>
                </ul>
            </div>
            
            <div class="insight-box">
                <div class="title">ğŸ’¡ æœ€ä½³è³£é»å€é–“åƒè€ƒ</div>
                <ul>
                    <li>ä¸»åŠ›å‡ºå ´é›†ä¸­å€é–“ç‚ºCBåƒ¹æ ¼<strong>127-145å…ƒ</strong></li>
                    <li>ä¸­ä½æ•¸142å…ƒæ˜¯é¤˜é¡æ¸›åŠçš„æ™‚é»ï¼Œæ­¤æ™‚ä¸»åŠ›å¯èƒ½å·²å‡ºå ´å¤§åŠ</li>
                    <li>è‹¥ä»¥ã€Œè·Ÿè‘—ä¸»åŠ›èµ°ã€ç‚ºç­–ç•¥ï¼ŒCBåƒ¹æ ¼é”<strong>130-140å…ƒ</strong>å€é–“å¯é–‹å§‹è€ƒæ…®åˆ†æ‰¹åœåˆ©</li>
                </ul>
            </div>
        </div>
    `;
}

// ==================== å•Ÿå‹• ====================
window.onload = init;
</script>

</body>
</html>